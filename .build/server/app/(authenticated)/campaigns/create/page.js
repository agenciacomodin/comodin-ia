(()=>{var e={};e.id=3846,e.ids=[3846],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},58898:(e,a,s)=>{"use strict";s.r(a),s.d(a,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>p,tree:()=>c}),s(59397),s(69910),s(71363),s(15307);var t=s(36576),i=s(72007),r=s(21818),n=s.n(r),d=s(88897),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);s.d(a,l);let c=["",{children:["(authenticated)",{children:["campaigns",{children:["create",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,59397)),"/home/ubuntu/comodin_ia/app/app/(authenticated)/campaigns/create/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,69910)),"/home/ubuntu/comodin_ia/app/app/(authenticated)/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,71363,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,15307)),"/home/ubuntu/comodin_ia/app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,71363,23)),"next/dist/client/components/not-found-error"]}],o=["/home/ubuntu/comodin_ia/app/app/(authenticated)/campaigns/create/page.tsx"],m="/(authenticated)/campaigns/create/page",u={require:s,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(authenticated)/campaigns/create/page",pathname:"/campaigns/create",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},56565:(e,a,s)=>{Promise.resolve().then(s.bind(s,85119))},85119:(e,a,s)=>{"use strict";s.d(a,{default:()=>w});var t=s(62901),i=s(24383),r=s.n(i),n=s(23803),d=s(27878),l=s(31606),c=s(250),o=s(82657),m=s(52),u=s(72388),p=s(21395),x=s(80568),h=s(32317),g=s(67935),N=s(66843),E=s(76021),j=s(23094),v=s(96527),f=s(60004),S=s(21391),A=s(82063),b=s(35825),y=s(26482),I=s(61673),C=s(7639),T=s(53524),R=s(60437),P=s(84374),D=s(97623),_=s(3844);function w({onCampaignCreated:e}){let[a,s]=(0,i.useState)(0),[l,c]=(0,i.useState)([]),[o,m]=(0,i.useState)(!0),[u,x]=(0,i.useState)(!1),{toast:b}=(0,R.pm)(),y=(0,P.useRouter)(),[I,C]=(0,i.useState)({type:"IMMEDIATE",sendRate:D.UM.SEND_RATE,batchSize:D.UM.BATCH_SIZE,timezone:"America/Mexico_City"}),[_,w]=(0,i.useState)(null),[H,B]=(0,i.useState)([]),[Z,G]=(0,i.useState)(null),[V,k]=(0,i.useState)({}),W=[{id:"template",title:"Seleccionar Plantilla",description:"Elige la plantilla de mensaje pre-aprobada",icon:h.Z,isCompleted:!!_},{id:"basic",title:"Informaci\xf3n B\xe1sica",description:"Configura los detalles b\xe1sicos de la campa\xf1a",icon:g.Z,isCompleted:!!I.name&&!!I.type},{id:"audience",title:"Constructor de Audiencias",description:"Define tu p\xfablico objetivo con precisi\xf3n",icon:N.Z,isCompleted:H.length>0&&!!Z},{id:"schedule",title:"Programaci\xf3n y Env\xedo",description:"Configura cu\xe1ndo y c\xf3mo enviar la campa\xf1a",icon:E.Z,isCompleted:"IMMEDIATE"===I.type||!!I.scheduledFor},{id:"review",title:"Revisi\xf3n y Confirmaci\xf3n",description:"Revisa todos los detalles antes de crear",icon:j.Z,isCompleted:!1}],z=e=>{let a={};switch(e){case 0:_||(a.template=["Debes seleccionar una plantilla"]);break;case 1:I.name||(a.name=["El nombre de la campa\xf1a es requerido"]),I.type||(a.type=["El tipo de campa\xf1a es requerido"]);break;case 2:0===H.length&&(a.audience=["Debes definir al menos un filtro de audiencia"]),Z||(a.preview=["Debes generar una vista previa de la audiencia"]);break;case 3:"SCHEDULED"!==I.type||I.scheduledFor||(a.schedule=["Debes seleccionar una fecha y hora para la campa\xf1a programada"]),I.sendRate&&(I.sendRate<1||I.sendRate>60)&&(a.sendRate=["La velocidad de env\xedo debe estar entre 1 y 60 mensajes por minuto"])}return k(a),0===Object.keys(a).length},q=async()=>{if(_&&Z)try{x(!0);let a=I.sendRate||D.UM.SEND_RATE,s=I.batchSize||D.UM.BATCH_SIZE,t=I.maxRecipients;I.type===T.CampaignType.WHATSAPP_BUSINESS?(a=D.wu.BUSINESS.SEND_RATE,s=D.wu.BUSINESS.BATCH_SIZE,(!t||t>D.wu.BUSINESS.MAX_DAILY_MESSAGES)&&(t=D.wu.BUSINESS.MAX_DAILY_MESSAGES)):I.type===T.CampaignType.WHATSAPP_API&&(a=D.wu.API.SEND_RATE,s=D.wu.API.BATCH_SIZE);let i={name:I.name,description:I.description,type:I.type,templateId:_.id,messageVariables:I.messageVariables||{},audienceFilters:H,maxRecipients:t,scheduledFor:I.scheduledFor?new Date(I.scheduledFor):void 0,timezone:I.timezone||"America/Mexico_City",sendRate:a,batchSize:s,budgetLimit:I.budgetLimit},r=await fetch("/api/campaigns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),n=await r.json();if(n.success)b({title:"\xc9xito",description:"Campa\xf1a creada exitosamente"}),e?.(n.data.id),y.push(`/campaigns/${n.data.id}`);else throw Error(n.error)}catch(e){console.error("Error creating campaign:",e),b({title:"Error",description:"Error al crear la campa\xf1a",variant:"destructive"})}finally{x(!1)}},Y=(a+1)/W.length*100;return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Crear Nueva Campa\xf1a"}),t.jsx("p",{className:"text-muted-foreground",children:"Asistente paso a paso para crear campa\xf1as profesionales con segmentaci\xf3n avanzada"}),t.jsx(p.E,{value:Y,className:"max-w-md mx-auto"})]}),t.jsx(n.Zb,{children:t.jsx(n.aY,{className:"p-6",children:t.jsx("div",{className:"flex justify-between items-center",children:W.map((e,s)=>{let i=e.icon,r=s===a,n=e.isCompleted,d=s<a;return(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx("div",{className:`
                    relative flex items-center justify-center w-12 h-12 rounded-full border-2 transition-colors
                    ${r?"border-primary bg-primary text-primary-foreground":n||d?"border-green-500 bg-green-500 text-white":"border-muted-foreground/30 text-muted-foreground"}
                  `,children:n||d?t.jsx(j.Z,{className:"h-6 w-6"}):t.jsx(i,{className:"h-6 w-6"})}),(0,t.jsxs)("div",{className:"text-center",children:[t.jsx("p",{className:`text-sm font-medium ${r?"text-primary":"text-muted-foreground"}`,children:e.title}),t.jsx("p",{className:"text-xs text-muted-foreground hidden sm:block",children:e.description})]})]},e.id)})})})}),(0,t.jsxs)(n.Zb,{children:[(0,t.jsxs)(n.Ol,{children:[(0,t.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[r().createElement(W[a].icon,{className:"h-5 w-5"}),t.jsx("span",{children:W[a].title})]}),t.jsx(n.SZ,{children:W[a].description})]}),t.jsx(n.aY,{className:"space-y-6",children:(()=>{switch(a){case 0:return t.jsx(O,{templates:l,loading:o,selectedTemplate:_,onSelectTemplate:w,errors:V});case 1:return t.jsx(M,{data:I,onChange:C,errors:V});case 2:return t.jsx(L,{filters:H,preview:Z,onFiltersChange:B,onPreviewChange:G,errors:V});case 3:return t.jsx(U,{data:I,onChange:C,audienceSize:Z?.totalContacts||0,errors:V});case 4:return t.jsx(F,{campaignData:I,selectedTemplate:_,audiencePreview:Z,audienceFilters:H,onCreateCampaign:q,creating:u});default:return null}})()})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)(d.z,{variant:"outline",onClick:()=>{a>0&&s(a-1)},disabled:0===a,children:[t.jsx(v.Z,{className:"mr-2 h-4 w-4"}),"Anterior"]}),a<W.length-1?(0,t.jsxs)(d.z,{onClick:()=>{z(a)&&a<W.length-1&&s(a+1)},children:["Siguiente",t.jsx(f.Z,{className:"ml-2 h-4 w-4"})]}):t.jsx(d.z,{onClick:q,disabled:u||!z(a),className:"bg-green-600 hover:bg-green-700",children:u?(0,t.jsxs)(t.Fragment,{children:[t.jsx(S.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Creando..."]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(A.Z,{className:"mr-2 h-4 w-4"}),"Crear Campa\xf1a"]})})]})]})}function O({templates:e,loading:a,selectedTemplate:s,onSelectTemplate:i,errors:r}){return a?t.jsx("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,a)=>t.jsx("div",{className:"animate-pulse",children:t.jsx("div",{className:"h-20 bg-gray-200 rounded-lg"})},a))}):0===e.length?(0,t.jsxs)(x.bZ,{children:[t.jsx(b.Z,{className:"h-4 w-4"}),t.jsx(x.X,{children:"No hay plantillas aprobadas disponibles. Necesitas crear y aprobar plantillas antes de crear campa\xf1as."})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[r.template&&(0,t.jsxs)(x.bZ,{variant:"destructive",children:[t.jsx(b.Z,{className:"h-4 w-4"}),t.jsx(x.X,{children:r.template[0]})]}),t.jsx("div",{className:"grid gap-4",children:e.map(e=>t.jsx(n.Zb,{className:`cursor-pointer transition-colors ${s?.id===e.id?"border-primary bg-primary/5":"hover:border-primary/50"}`,onClick:()=>i(e),children:t.jsx(n.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("h3",{className:"font-medium",children:e.name}),t.jsx(l.C,{variant:"secondary",className:"text-xs",children:e.category}),t.jsx(l.C,{variant:"outline",className:"text-xs",children:e.language.toUpperCase()})]}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.bodyContent}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{children:["Usado ",e.usageCount," veces"]}),e.successfulSends>0&&(0,t.jsxs)(t.Fragment,{children:[t.jsx("span",{children:"•"}),(0,t.jsxs)("span",{children:[e.successfulSends," env\xedos exitosos"]})]})]})]}),s?.id===e.id&&t.jsx("div",{className:"ml-4",children:t.jsx(j.Z,{className:"h-5 w-5 text-primary"})})]})})},e.id))})]})}function M({data:e,onChange:a,errors:s}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(s.name||s.type)&&(0,t.jsxs)(x.bZ,{variant:"destructive",children:[t.jsx(b.Z,{className:"h-4 w-4"}),t.jsx(x.X,{children:s.name?.[0]||s.type?.[0]})]}),(0,t.jsxs)("div",{className:"grid gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o.Label,{htmlFor:"campaign-name",children:"Nombre de la campa\xf1a *"}),t.jsx(c.I,{id:"campaign-name",placeholder:"Ej: Promoci\xf3n Black Friday 2024",value:e.name||"",onChange:s=>a({...e,name:s.target.value}),className:s.name?"border-red-500":""})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o.Label,{htmlFor:"campaign-description",children:"Descripci\xf3n (opcional)"}),t.jsx(m.g,{id:"campaign-description",placeholder:"Describe el objetivo y detalles de la campa\xf1a...",value:e.description||"",onChange:s=>a({...e,description:s.target.value}),rows:3})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o.Label,{htmlFor:"campaign-type",children:"Tipo de campa\xf1a *"}),(0,t.jsxs)(u.Ph,{value:e.type,onValueChange:s=>a({...e,type:s}),children:[t.jsx(u.i4,{className:s.type?"border-red-500":"",children:t.jsx(u.ki,{placeholder:"Selecciona el tipo de campa\xf1a"})}),(0,t.jsxs)(u.Bw,{children:[t.jsx(u.Ql,{value:"IMMEDIATE",children:(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium",children:D.Rh.IMMEDIATE}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Env\xedo inmediato una vez confirmada"})]})}),t.jsx(u.Ql,{value:"SCHEDULED",children:(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium",children:D.Rh.SCHEDULED}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Programar para una fecha y hora espec\xedfica"})]})}),t.jsx(u.Ql,{value:"DRIP",children:(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium",children:D.Rh.DRIP}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Campa\xf1a secuencial con m\xfaltiples mensajes"})]})}),t.jsx(u.Ql,{value:"AB_TEST",children:(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium",children:D.Rh.AB_TEST}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Prueba A/B para optimizar mensajes"})]})}),t.jsx(u.Ql,{value:"WHATSAPP_BUSINESS",children:(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium",children:D.Rh.WHATSAPP_BUSINESS}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"M\xe1ximo 40 mensajes/d\xeda, cualquier contenido"})]})}),t.jsx(u.Ql,{value:"WHATSAPP_API",children:(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium",children:D.Rh.WHATSAPP_API}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Env\xedo ilimitado, solo plantillas verificadas"})]})})]})]})]}),(e.type===T.CampaignType.WHATSAPP_BUSINESS||e.type===T.CampaignType.WHATSAPP_API)&&(0,t.jsxs)("div",{className:"rounded-lg border bg-gradient-to-r from-green-50 to-blue-50 p-4",children:[(0,t.jsxs)("h4",{className:"font-medium text-gray-900 mb-2",children:[e.type===T.CampaignType.WHATSAPP_BUSINESS?"WhatsApp Business":"WhatsApp API"," - Caracter\xedsticas"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"font-medium",children:"L\xedmite diario:"}),t.jsx(l.C,{variant:"WHATSAPP_BUSINESS"===e.type?"destructive":"default",children:"WHATSAPP_BUSINESS"===e.type?"40 mensajes":"Ilimitado"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"font-medium",children:"Plantillas:"}),t.jsx(l.C,{variant:"WHATSAPP_BUSINESS"===e.type?"default":"outline",children:"WHATSAPP_BUSINESS"===e.type?"No requeridas":"Solo verificadas"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"font-medium",children:"Velocidad:"}),t.jsx("span",{className:"text-gray-600",children:"WHATSAPP_BUSINESS"===e.type?"2 msg/min":"50 msg/min"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"font-medium",children:"Multimedia:"}),t.jsx("span",{className:"text-green-600",children:"✓ Soportado"})]})]})]}),t.jsx("div",{className:"mt-3 p-3 bg-white/50 rounded border border-gray-200",children:(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:[t.jsx("strong",{children:"Recomendaci\xf3n:"})," ",D.C2[e.type]]})})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o.Label,{htmlFor:"max-recipients",children:"L\xedmite m\xe1ximo de destinatarios (opcional)"}),t.jsx(c.I,{id:"max-recipients",type:"number",placeholder:"Ej: 5000",value:e.maxRecipients||"",onChange:s=>a({...e,maxRecipients:s.target.value?parseInt(s.target.value):void 0}),min:"1",max:"50000"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"\xdatil para pruebas A/B o env\xedos graduales. Deja en blanco para enviar a toda la audiencia."})]})]})]})}function L({filters:e,preview:a,onFiltersChange:s,onPreviewChange:i,errors:r}){return(0,t.jsxs)("div",{className:"space-y-4",children:[(r.audience||r.preview)&&(0,t.jsxs)(x.bZ,{variant:"destructive",children:[t.jsx(b.Z,{className:"h-4 w-4"}),t.jsx(x.X,{children:r.audience?.[0]||r.preview?.[0]})]}),t.jsx(_.default,{initialFilters:e,onFiltersChange:s,onPreviewGenerated:i})]})}function U({data:e,onChange:a,audienceSize:s,errors:i}){let r=s&&e.sendRate?Math.ceil(s/e.sendRate):0;return(0,t.jsxs)("div",{className:"space-y-6",children:[(i.schedule||i.sendRate)&&(0,t.jsxs)(x.bZ,{variant:"destructive",children:[t.jsx(b.Z,{className:"h-4 w-4"}),t.jsx(x.X,{children:i.schedule?.[0]||i.sendRate?.[0]})]}),"SCHEDULED"===e.type&&(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o.Label,{htmlFor:"scheduled-for",children:"Fecha y hora de env\xedo *"}),t.jsx(c.I,{id:"scheduled-for",type:"datetime-local",value:e.scheduledFor?"string"==typeof e.scheduledFor?e.scheduledFor:e.scheduledFor.toISOString().slice(0,16):"",onChange:s=>a({...e,scheduledFor:s.target.value?new Date(s.target.value):void 0}),className:i.schedule?"border-red-500":"",min:new Date().toISOString().slice(0,16)})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o.Label,{htmlFor:"send-rate",children:"Velocidad de env\xedo (mensajes/minuto)"}),t.jsx(c.I,{id:"send-rate",type:"number",value:e.sendRate||D.UM.SEND_RATE,onChange:s=>a({...e,sendRate:parseInt(s.target.value)}),min:"1",max:"60",className:i.sendRate?"border-red-500":""}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Controla la velocidad para evitar saturar los servidores"})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o.Label,{htmlFor:"batch-size",children:"Tama\xf1o de lote"}),t.jsx(c.I,{id:"batch-size",type:"number",value:e.batchSize||D.UM.BATCH_SIZE,onChange:s=>a({...e,batchSize:parseInt(s.target.value)}),min:"10",max:"1000"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"N\xfamero de mensajes procesados en cada lote"})]})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o.Label,{htmlFor:"budget-limit",children:"L\xedmite de presupuesto (USD, opcional)"}),t.jsx(c.I,{id:"budget-limit",type:"number",step:"0.01",placeholder:"Ej: 100.00",value:e.budgetLimit||"",onChange:s=>a({...e,budgetLimit:s.target.value?parseFloat(s.target.value):void 0}),min:"0"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"La campa\xf1a se pausar\xe1 autom\xe1ticamente si se alcanza este l\xedmite"})]}),s>0&&t.jsx(n.Zb,{className:"bg-blue-50 border-blue-200",children:(0,t.jsxs)(n.aY,{className:"p-4",children:[t.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Estimaci\xf3n de Campa\xf1a"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-blue-700",children:"Audiencia:"}),(0,t.jsxs)("p",{className:"font-medium",children:[s.toLocaleString()," contactos"]})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-blue-700",children:"Duraci\xf3n estimada:"}),(0,t.jsxs)("p",{className:"font-medium",children:[r," minutos"]})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-blue-700",children:"Costo estimado:"}),t.jsx("p",{className:"font-medium",children:"$0.05 - $0.15 USD"})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-blue-700",children:"Entrega estimada:"}),t.jsx("p",{className:"font-medium",children:"85% - 95%"})]})]})]})})]})}function F({campaignData:e,selectedTemplate:a,audiencePreview:s,audienceFilters:i,onCreateCampaign:r,creating:c}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(x.bZ,{children:[t.jsx(j.Z,{className:"h-4 w-4"}),t.jsx(x.X,{children:"Revisa cuidadosamente todos los detalles antes de crear la campa\xf1a. Una vez creada, algunos elementos no podr\xe1n modificarse."})]}),(0,t.jsxs)("div",{className:"grid gap-6",children:[(0,t.jsxs)(n.Zb,{children:[t.jsx(n.Ol,{children:t.jsx(n.ll,{className:"text-base",children:"Informaci\xf3n de la Campa\xf1a"})}),(0,t.jsxs)(n.aY,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Nombre:"}),t.jsx("span",{className:"font-medium",children:e.name})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Tipo:"}),t.jsx(l.C,{variant:"secondary",children:D.Rh[e.type]})]}),e.description&&(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Descripci\xf3n:"}),t.jsx("span",{className:"font-medium text-right max-w-xs",children:e.description})]}),e.scheduledFor&&(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Programada para:"}),t.jsx("span",{className:"font-medium",children:(0,I.WU)(new Date(e.scheduledFor),"dd/MM/yyyy HH:mm",{locale:C.es})})]})]})]}),(0,t.jsxs)(n.Zb,{children:[t.jsx(n.Ol,{children:t.jsx(n.ll,{className:"text-base",children:"Plantilla Seleccionada"})}),t.jsx(n.aY,{children:a&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"font-medium",children:a.name}),t.jsx(l.C,{variant:"outline",className:"text-xs",children:a.category})]}),t.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:t.jsx("p",{className:"text-sm",children:a.bodyContent})}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Usado ",a.usageCount," veces • ",a.successfulSends," env\xedos exitosos"]})]})})]}),(0,t.jsxs)(n.Zb,{children:[t.jsx(n.Ol,{children:t.jsx(n.ll,{className:"text-base",children:"Audiencia Objetivo"})}),t.jsx(n.aY,{children:s&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("span",{className:"font-medium text-lg",children:[s.totalContacts.toLocaleString()," contactos"]}),(0,t.jsxs)(l.C,{variant:"outline",children:[s.vipCount," VIP"]})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Filtros aplicados: ",i.length," criterio",1!==i.length?"s":""]}),(0,t.jsxs)("div",{className:"space-y-1",children:[i.slice(0,3).map((e,a)=>(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["• ",D.mT[e.type]]},a)),i.length>3&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["... y ",i.length-3," filtro",i.length-3!=1?"s":""," m\xe1s"]})]})]})})]}),(0,t.jsxs)(n.Zb,{children:[t.jsx(n.Ol,{children:t.jsx(n.ll,{className:"text-base",children:"Configuraci\xf3n de Env\xedo"})}),(0,t.jsxs)(n.aY,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Velocidad:"}),(0,t.jsxs)("span",{className:"font-medium",children:[e.sendRate," mensajes/minuto"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Tama\xf1o de lote:"}),(0,t.jsxs)("span",{className:"font-medium",children:[e.batchSize," mensajes"]})]}),e.maxRecipients&&(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"L\xedmite m\xe1ximo:"}),(0,t.jsxs)("span",{className:"font-medium",children:[e.maxRecipients.toLocaleString()," contactos"]})]}),e.budgetLimit&&(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"L\xedmite de presupuesto:"}),(0,t.jsxs)("span",{className:"font-medium",children:["$",e.budgetLimit," USD"]})]})]})]})]}),t.jsx("div",{className:"flex justify-center pt-4",children:t.jsx(d.z,{onClick:r,disabled:c,size:"lg",className:"bg-green-600 hover:bg-green-700 min-w-[200px]",children:c?(0,t.jsxs)(t.Fragment,{children:[t.jsx(S.Z,{className:"mr-2 h-5 w-5 animate-spin"}),"Creando Campa\xf1a..."]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(y.Z,{className:"mr-2 h-5 w-5"}),"Crear Campa\xf1a"]})})})]})}},80568:(e,a,s)=>{"use strict";s.d(a,{Cd:()=>c,X:()=>o,bZ:()=>l});var t=s(62901),i=s(24383),r=s(47279),n=s(68637);let d=(0,r.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),l=i.forwardRef(({className:e,variant:a,...s},i)=>t.jsx("div",{ref:i,role:"alert",className:(0,n.cn)(d({variant:a}),e),...s}));l.displayName="Alert";let c=i.forwardRef(({className:e,...a},s)=>t.jsx("h5",{ref:s,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",e),...a}));c.displayName="AlertTitle";let o=i.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",e),...a}));o.displayName="AlertDescription"},21395:(e,a,s)=>{"use strict";s.d(a,{E:()=>f});var t=s(62901),i=s(24383),r=s(89291),n=s(74132),d="Progress",[l,c]=(0,r.b)(d),[o,m]=l(d),u=i.forwardRef((e,a)=>{var s,i;let{__scopeProgress:r,value:d=null,max:l,getValueLabel:c=h,...m}=e;(l||0===l)&&!E(l)&&console.error((s=`${l}`,`Invalid prop \`max\` of value \`${s}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let u=E(l)?l:100;null===d||j(d,u)||console.error((i=`${d}`,`Invalid prop \`value\` of value \`${i}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let p=j(d,u)?d:null,x=N(p)?c(p,u):void 0;return(0,t.jsx)(o,{scope:r,value:p,max:u,children:(0,t.jsx)(n.WV.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":N(p)?p:void 0,"aria-valuetext":x,role:"progressbar","data-state":g(p,u),"data-value":p??void 0,"data-max":u,...m,ref:a})})});u.displayName=d;var p="ProgressIndicator",x=i.forwardRef((e,a)=>{let{__scopeProgress:s,...i}=e,r=m(p,s);return(0,t.jsx)(n.WV.div,{"data-state":g(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...i,ref:a})});function h(e,a){return`${Math.round(e/a*100)}%`}function g(e,a){return null==e?"indeterminate":e===a?"complete":"loading"}function N(e){return"number"==typeof e}function E(e){return N(e)&&!isNaN(e)&&e>0}function j(e,a){return N(e)&&!isNaN(e)&&e<=a&&e>=0}x.displayName=p;var v=s(68637);let f=i.forwardRef(({className:e,value:a,...s},i)=>t.jsx(u,{ref:i,className:(0,v.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...s,children:t.jsx(x,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));f.displayName=u.displayName},52:(e,a,s)=>{"use strict";s.d(a,{g:()=>n});var t=s(62901),i=s(24383),r=s(68637);let n=i.forwardRef(({className:e,...a},s)=>t.jsx("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...a}));n.displayName="Textarea"},97623:(e,a,s)=>{"use strict";s.d(a,{BT:()=>i.AutomationActionType,C2:()=>T,DX:()=>b,Dn:()=>y,ED:()=>p,Eb:()=>N,FQ:()=>E,Go:()=>n,Jg:()=>x,Om:()=>o,Pg:()=>f,Rh:()=>C,Rn:()=>g,Sn:()=>l,UM:()=>P,Ug:()=>S,Vb:()=>i.AutomationConditionType,WC:()=>d,WV:()=>A,WY:()=>r,aE:()=>m,d1:()=>h,fB:()=>c,hC:()=>i.KnowledgeSourceStatus,hQ:()=>j,mT:()=>R,n9:()=>u,rH:()=>i.KnowledgeSourceType,uU:()=>I,wu:()=>D,ym:()=>v});var t,i=s(53524);!function(e){e.INSUFFICIENT_BALANCE="INSUFFICIENT_BALANCE",e.NO_PROVIDER_AVAILABLE="NO_PROVIDER_AVAILABLE",e.PROVIDER_ERROR="PROVIDER_ERROR",e.INVALID_REQUEST="INVALID_REQUEST",e.RATE_LIMIT_EXCEEDED="RATE_LIMIT_EXCEEDED",e.INTERNAL_ERROR="INTERNAL_ERROR"}(t||(t={}));let r={OPEN:"Abierta",PENDING:"Pendiente",RESOLVED:"Resuelta",TRANSFERRED:"Transferida",ARCHIVED:"Archivada"},n={LOW:"Baja",MEDIUM:"Media",HIGH:"Alta",URGENT:"Urgente"},d={LOW:"gray",MEDIUM:"blue",HIGH:"orange",URGENT:"red"},l={QR_CODE:"Conexi\xf3n R\xe1pida (QR)",API_OFFICIAL:"Conexi\xf3n Profesional (API)"},c={DISCONNECTED:"Desconectado",CONNECTING:"Conectando",CONNECTED:"Conectado",ERROR:"Error",EXPIRED:"Expirado"},o={DISCONNECTED:"gray",CONNECTING:"yellow",CONNECTED:"green",ERROR:"red",EXPIRED:"orange"},m={image:["image/jpeg","image/png","image/gif","image/webp"],document:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"],video:["video/mp4","video/avi","video/mov","video/wmv"],audio:["audio/mp3","audio/wav","audio/aac","audio/ogg"]},u={image:10485760,document:52428800,video:104857600,audio:20971520},p={SALES:"Ventas",SUPPORT:"Soporte",QUESTION:"Pregunta",COMPLAINT:"Queja",BOOKING:"Reserva",PAYMENT:"Pago",INFORMATION:"Informaci\xf3n",GREETING:"Saludo",FAREWELL:"Despedida",OTHER:"Otro"},x={SALES:"green",SUPPORT:"blue",QUESTION:"yellow",COMPLAINT:"red",BOOKING:"purple",PAYMENT:"orange",INFORMATION:"cyan",GREETING:"teal",FAREWELL:"gray",OTHER:"slate"},h={INTENTION_DETECTED:"Intenci\xf3n detectada",KEYWORDS_CONTAINS:"Contiene palabras clave",SENDER_IS_VIP:"Remitente es VIP",TIME_RANGE:"Horario espec\xedfico",FIRST_MESSAGE:"Primer mensaje",MESSAGE_COUNT:"N\xfamero de mensajes",RESPONSE_TIME:"Tiempo de respuesta"},g={ADD_TAG:"Agregar etiqueta",ASSIGN_AGENT:"Asignar agente",SET_PRIORITY:"Establecer prioridad",AUTO_REPLY:"Respuesta autom\xe1tica",MARK_VIP:"Marcar como VIP",TRANSFER_CONVERSATION:"Transferir conversaci\xf3n",CREATE_TASK:"Crear tarea",SEND_NOTIFICATION:"Enviar notificaci\xf3n"},N={pdf:["application/pdf"],document:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],text:["text/plain","text/markdown","text/csv"],web:["text/html"]},E=52428800,j={UPLOADING:"Subiendo",PROCESSING:"Procesando",CHUNKING:"Fragmentando",EMBEDDING:"Generando Embeddings",ACTIVE:"Activo",ERROR:"Error",DISABLED:"Deshabilitado"},v={ECOMMERCE:"E-commerce",CRM:"CRM",ERP:"ERP",PAYMENT:"Pagos",ANALYTICS:"An\xe1lisis",MARKETING:"Marketing",SOCIAL_MEDIA:"Redes Sociales",EMAIL:"Email Marketing",SUPPORT:"Soporte",OTHER:"Otros"},f={AVAILABLE:"Disponible",CONNECTED:"Conectado",DISCONNECTED:"Desconectado",ERROR:"Error",PENDING:"Pendiente"},S={SHOPIFY:{displayName:"Shopify",description:"Conecta tu tienda Shopify para consultar productos, pedidos e inventario",authType:"oauth",authFields:["shop_domain","access_token"],iconUrl:"/integrations/shopify.svg",brandColor:"#7AB55C",supportedFeatures:["products","orders","customers","inventory"],documentation:"https://docs.shopify.com/api"},WOOCOMMERCE:{displayName:"WooCommerce",description:"Conecta tu tienda WooCommerce para gestionar productos y pedidos",authType:"api_key",authFields:["site_url","consumer_key","consumer_secret"],iconUrl:"/integrations/woocommerce.svg",brandColor:"#7F54B3",supportedFeatures:["products","orders","customers"],documentation:"https://woocommerce.github.io/woocommerce-rest-api-docs/"},TIENDANUBE:{displayName:"TiendaNube",description:"Conecta tu tienda TiendaNube para sincronizar cat\xe1logo y pedidos",authType:"oauth",authFields:["store_id","access_token"],iconUrl:"/integrations/tiendanube.svg",brandColor:"#FF6900",supportedFeatures:["products","orders","customers"],documentation:"https://developers.tiendanube.com/"}},A={PENDING:"Pendiente",APPROVED:"Aprobada",REJECTED:"Rechazada",PAUSED:"Pausada",ARCHIVED:"Archivada"},b={PENDING:"yellow",APPROVED:"green",REJECTED:"red",PAUSED:"orange",ARCHIVED:"gray"},y={DRAFT:"Borrador",SCHEDULED:"Programada",SENDING:"Enviando",COMPLETED:"Completada",PAUSED:"Pausada",CANCELLED:"Cancelada",FAILED:"Fallida"},I={DRAFT:"gray",SCHEDULED:"blue",SENDING:"yellow",COMPLETED:"green",PAUSED:"orange",CANCELLED:"red",FAILED:"red"},C={IMMEDIATE:"Inmediato",SCHEDULED:"Programado",DRIP:"Secuencial",AB_TEST:"Prueba A/B",WHATSAPP_BUSINESS:"WhatsApp Business",WHATSAPP_API:"WhatsApp API"},T={IMMEDIATE:"Env\xedo inmediato a todos los destinatarios",SCHEDULED:"Env\xedo programado para una fecha espec\xedfica",DRIP:"Env\xedo secuencial con intervalos definidos",AB_TEST:"Prueba diferentes versiones del mensaje",WHATSAPP_BUSINESS:"M\xe1ximo 40 mensajes diarios, cualquier contenido (texto/imagen/video/audio)",WHATSAPP_API:"Env\xedo ilimitado, solo plantillas verificadas por Meta"},R={INCLUDE_TAG:"Incluir etiqueta",EXCLUDE_TAG:"Excluir etiqueta",CHANNEL:"Canal de origen",VIP_STATUS:"Estado VIP",LAST_CONTACT:"\xdaltimo contacto",CONVERSATION_STATUS:"Estado de conversaci\xf3n"},P={SEND_RATE:10,BATCH_SIZE:100,RETRY_ATTEMPTS:3,PREVIEW_SAMPLE_SIZE:20,PREVIEW_EXPIRATION_HOURS:24},D={BUSINESS:{MAX_DAILY_MESSAGES:40,SEND_RATE:2,BATCH_SIZE:10,REQUIRES_VERIFICATION:!1,SUPPORTS_RICH_MEDIA:!0},API:{MAX_DAILY_MESSAGES:null,SEND_RATE:50,BATCH_SIZE:500,REQUIRES_VERIFICATION:!0,SUPPORTS_RICH_MEDIA:!0}}},35825:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(71945).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},23094:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(71945).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},32317:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(71945).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},26482:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(71945).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},59397:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>o,metadata:()=>c});var t=s(83537),i=s(57978),r=s(15438),n=s(11826),d=s(25590);let l=(0,s(88895).createProxy)(String.raw`/home/ubuntu/comodin_ia/app/components/campaigns/campaign-wizard.tsx#default`),c={title:"Crear Campa\xf1a - COMOD\xcdN IA",description:"Crear nueva campa\xf1a con segmentaci\xf3n avanzada"};async function o(){let e=await (0,i.getServerSession)(n.L);return e?.user?.organizationId||(0,r.redirect)("/auth/signin"),(0,d.N$)(e.user.role,d.y3.CREATE_CAMPAIGNS)||(0,r.redirect)("/campaigns"),t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx(l,{})})}}};var a=require("../../../../webpack-runtime.js");a.C(e);var s=e=>a(a.s=e),t=a.X(0,[4372,7329,1472,7420,5003,8855,9358,533,6129,1811,7316,1826,6003,4111],()=>s(58898));module.exports=t})();