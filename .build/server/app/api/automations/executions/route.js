"use strict";(()=>{var e={};e.id=8438,e.ids=[8438],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},11263:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>x,serverHooks:()=>q,staticGenerationAsyncStorage:()=>g});var o={};r.r(o),r.d(o,{GET:()=>l});var n=r(79182),s=r(72007),i=r(56719),a=r(93442),u=r(15649),c=r(53524),d=r(11826);let p=new c.PrismaClient;async function l(e){try{let t=await (0,u.getServerSession)(d.L);if(!t?.user?.organizationId)return a.NextResponse.json({error:"No autorizado"},{status:401});let{searchParams:r}=new URL(e.url),o=parseInt(r.get("page")||"1"),n=Math.min(parseInt(r.get("limit")||"25"),100),s=r.get("ruleId"),i=r.get("success"),c=(o-1)*n,l={rule:{organizationId:t.user.organizationId}};s&&(l.ruleId=s),null!==i&&(l.success="true"===i);let[x,m]=await Promise.all([p.automationExecution.findMany({where:l,include:{rule:{select:{name:!0}}},orderBy:{createdAt:"desc"},skip:c,take:n}),p.automationExecution.count({where:l})]),g=await Promise.all(x.map(async e=>{let t=null;if(e.contactId){let r=await p.contact.findUnique({where:{id:e.contactId},select:{name:!0}});t=r?.name||null}return{id:e.id,ruleId:e.ruleId,ruleName:e.rule.name,messageId:e.messageId,conversationId:e.conversationId,contactId:e.contactId,contactName:t,success:e.success,error:e.error,executionTime:e.executionTime,detectedIntentions:e.detectedIntentions,confidenceScore:e.confidenceScore?.toNumber(),keywordsFound:e.keywordsFound,actionsExecuted:e.actionsExecuted,actionsSkipped:e.actionsSkipped,createdAt:e.createdAt}}));return a.NextResponse.json({success:!0,data:g,pagination:{page:o,limit:n,total:m,totalPages:Math.ceil(m/n)}})}catch(e){return console.error("Error obteniendo historial de ejecuciones:",e),a.NextResponse.json({success:!1,error:"Error interno del servidor"},{status:500})}}let x=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/automations/executions/route",pathname:"/api/automations/executions",filename:"route",bundlePath:"app/api/automations/executions/route"},resolvedPagePath:"/home/ubuntu/comodin_ia/app/app/api/automations/executions/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:q}=x,I="/api/automations/executions/route";function h(){return(0,i.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[4372,7329,1472,7609,1826],()=>r(11263));module.exports=o})();