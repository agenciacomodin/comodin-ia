"use strict";(()=>{var e={};e.id=1830,e.ids=[1830],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},88320:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>E,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var o={};r.r(o),r.d(o,{GET:()=>x});var s=r(79182),n=r(72007),a=r(56719),i=r(93442),u=r(15649),c=r(53524),p=r(11826);let l=new c.PrismaClient;async function x(e){try{let e=await (0,u.getServerSession)(p.L);if(!e?.user?.organizationId)return i.NextResponse.json({error:"No autorizado"},{status:401});let t=e.user.organizationId,[r,o,s,n,a,c,x]=await Promise.all([l.automationRule.count({where:{organizationId:t}}),l.automationRule.count({where:{organizationId:t,isActive:!0}}),l.automationExecution.count({where:{rule:{organizationId:t}}}),l.automationExecution.count({where:{rule:{organizationId:t},success:!0}}),l.automationExecution.count({where:{rule:{organizationId:t},success:!1}}),l.automationExecution.aggregate({where:{rule:{organizationId:t}},_avg:{executionTime:!0}}),l.automationExecution.count({where:{rule:{organizationId:t},createdAt:{gte:new Date(new Date().setHours(0,0,0,0))}}})]),d=await l.automationExecution.findMany({where:{rule:{organizationId:t},success:!0},select:{detectedIntentions:!0}}),m={};d.forEach(e=>{e.detectedIntentions.forEach(e=>{m[e]=(m[e]||0)+1})});let h=Object.entries(m).map(([e,t])=>({intention:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,5),g=await l.automationExecution.findMany({where:{rule:{organizationId:t},success:!0},select:{actionsExecuted:!0}}),q={};g.forEach(e=>{Array.isArray(e.actionsExecuted)&&e.actionsExecuted.forEach(e=>{e.type&&(q[e.type]=(q[e.type]||0)+1)})});let E=Object.entries(q).map(([e,t])=>({action:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,5),w={totalRules:r,activeRules:o,totalExecutions:s,successfulExecutions:n,failedExecutions:a,avgExecutionTime:Math.round(c._avg.executionTime||0),executionsToday:x,topIntentions:h,topActions:E};return i.NextResponse.json({success:!0,data:w})}catch(e){return console.error("Error obteniendo estad\xedsticas de automatizaci\xf3n:",e),i.NextResponse.json({success:!1,error:"Error interno del servidor"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/automations/stats/route",pathname:"/api/automations/stats",filename:"route",bundlePath:"app/api/automations/stats/route"},resolvedPagePath:"/home/ubuntu/comodin_ia/app/app/api/automations/stats/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g}=d,q="/api/automations/stats/route";function E(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[4372,7329,1472,7609,1826],()=>r(88320));module.exports=o})();