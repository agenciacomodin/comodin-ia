"use strict";(()=>{var e={};e.id=9971,e.ids=[9971],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},96858:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>h,patchFetch:()=>j,requestAsyncStorage:()=>x,routeModule:()=>l,serverHooks:()=>q,staticGenerationAsyncStorage:()=>g});var t={};s.r(t),s.d(t,{POST:()=>d});var n=s(79182),o=s(72007),i=s(56719),a=s(93442),u=s(15649),p=s(53524),c=s(11826);let m=new p.PrismaClient;async function d(e){try{let r=await (0,u.getServerSession)(c.L);if(!r?.user?.organizationId)return a.NextResponse.json({error:"No autorizado"},{status:401});if("PROPIETARIO"!==r.user.role)return a.NextResponse.json({error:"Solo el propietario puede simular mensajes"},{status:403});let{conversationId:s,content:t}=await e.json();if(!s||!t?.trim())return a.NextResponse.json({success:!1,error:"ID de conversaci\xf3n y contenido son requeridos"},{status:400});if(!await m.conversation.findFirst({where:{id:s,organizationId:r.user.organizationId},include:{contact:!0}}))return a.NextResponse.json({success:!1,error:"Conversaci\xf3n no encontrada"},{status:404});let n=await fetch(`${process.env.NEXTAUTH_URL}/api/crm/messages/incoming`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organizationId:r.user.organizationId,conversationId:s,content:t,whatsappMessageId:`sim_${Date.now()}`,whatsappChannelId:"simulation"})}),o=await n.json();if(!o.success)throw Error(o.error||"Error simulando mensaje");return a.NextResponse.json({success:!0,data:o.data,message:"Mensaje simulado exitosamente"})}catch(e){return console.error("Error simulando mensaje entrante:",e),a.NextResponse.json({success:!1,error:"Error interno del servidor"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/crm/messages/simulate-incoming/route",pathname:"/api/crm/messages/simulate-incoming",filename:"route",bundlePath:"app/api/crm/messages/simulate-incoming/route"},resolvedPagePath:"/home/ubuntu/comodin_ia/app/app/api/crm/messages/simulate-incoming/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:q}=l,h="/api/crm/messages/simulate-incoming/route";function j(){return(0,i.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:g})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4372,7329,1472,7609,1826],()=>s(96858));module.exports=t})();