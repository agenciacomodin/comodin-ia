"use strict";(()=>{var e={};e.id=6198,e.ids=[6198],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},85471:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>S,requestAsyncStorage:()=>w,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var o={};r.r(o),r.d(o,{GET:()=>p});var s=r(79182),n=r(72007),a=r(56719),u=r(93442),i=r(57978),d=r(11826),c=r(53524);let l=new c.PrismaClient;async function p(e){try{let e=await (0,i.getServerSession)(d.L);if(!e?.user)return u.NextResponse.json({error:"No autorizado"},{status:401});let t=e.user.organizationId,[r,o,s,n,a,p,g,w,m,h,x]=await Promise.all([l.knowledgeSource.count({where:{organizationId:t}}),l.knowledgeSource.count({where:{organizationId:t,status:c.KnowledgeSourceStatus.ACTIVE}}),l.knowledgeSource.count({where:{organizationId:t,status:{in:[c.KnowledgeSourceStatus.PROCESSING,c.KnowledgeSourceStatus.CHUNKING,c.KnowledgeSourceStatus.EMBEDDING]}}}),l.knowledgeSource.count({where:{organizationId:t,status:c.KnowledgeSourceStatus.ERROR}}),l.knowledgeSource.aggregate({where:{organizationId:t},_sum:{totalChunks:!0}}).then(e=>e._sum.totalChunks||0),l.knowledgeSource.aggregate({where:{organizationId:t},_sum:{processedChunks:!0}}).then(e=>e._sum.processedChunks||0),l.knowledgeSource.aggregate({where:{organizationId:t},_sum:{failedChunks:!0}}).then(e=>e._sum.failedChunks||0),l.knowledgeUsage.count({where:{organizationId:t}}),l.knowledgeUsage.count({where:{organizationId:t,createdAt:{gte:new Date(new Date().getFullYear(),new Date().getMonth(),1)}}}),l.knowledgeSource.findMany({where:{organizationId:t,status:c.KnowledgeSourceStatus.ACTIVE},select:{id:!0,name:!0,usageCount:!0,contentQuality:!0},orderBy:{usageCount:"desc"},take:5}),l.knowledgeSource.findMany({where:{organizationId:t},select:{id:!0,name:!0,status:!0,createdAt:!0,updatedAt:!0},orderBy:{updatedAt:"desc"},take:10})]),S=await l.knowledgeSource.aggregate({where:{organizationId:t,contentQuality:{not:null}},_avg:{contentQuality:!0}}),k=S._avg.contentQuality?.toNumber()||0,q=h.map(e=>({id:e.id,name:e.name,usageCount:e.usageCount,quality:e.contentQuality?.toNumber()})),y=x.map(e=>({id:e.id,action:e.createdAt.getTime()===e.updatedAt.getTime()?"created":"updated",sourceName:e.name,timestamp:e.updatedAt,status:e.status}));return u.NextResponse.json({success:!0,data:{totalSources:r,activeSources:o,processingSources:s,errorSources:n,totalChunks:a,processedChunks:p,failedChunks:g,totalUsage:w,usageThisMonth:m,avgQuality:k,topSources:q,recentActivity:y}})}catch(e){return console.error("Error obteniendo estad\xedsticas de conocimiento:",e),u.NextResponse.json({error:"Error interno del servidor"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/knowledge/stats/route",pathname:"/api/knowledge/stats",filename:"route",bundlePath:"app/api/knowledge/stats/route"},resolvedPagePath:"/home/ubuntu/comodin_ia/app/app/api/knowledge/stats/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:w,staticGenerationAsyncStorage:m,serverHooks:h}=g,x="/api/knowledge/stats/route";function S(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[4372,7329,1472,7609,1826],()=>r(85471));module.exports=o})();