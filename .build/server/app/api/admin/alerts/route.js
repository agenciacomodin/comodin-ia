"use strict";(()=>{var e={};e.id=105,e.ids=[105],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},38755:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>d});var s=r(79182),n=r(72007),o=r(56719),i=r(93442),u=r(57978),p=r(11826),l=r(83178);async function d(e){try{let e=await (0,u.getServerSession)(p.L);if(!e||"SUPER_ADMIN"!==e.user.role)return i.NextResponse.json({error:"Unauthorized"},{status:401});let t=await c();return i.NextResponse.json({alerts:t})}catch(e){return console.error("Error fetching alerts:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(){let e=[];try{let t=await l._.user.count({where:{lastLogin:{lt:new Date(Date.now()-6048e5)}}});t>0&&e.push({id:"inactive-users",type:"warning",title:"Usuarios Inactivos",message:`${t} usuarios no han estado activos en los \xfaltimos 7 d\xedas`,timestamp:new Date,resolved:!1,metadata:{count:t}});let r=await l._.payment.count({where:{status:"FAILED",createdAt:{gte:new Date(Date.now()-864e5)}}});r>0&&e.push({id:"failed-payments",type:"error",title:"Pagos Fallidos",message:`${r} pagos han fallado en las \xfaltimas 24 horas`,timestamp:new Date,resolved:!1,metadata:{count:r}});let a=await l._.subscription.count({where:{status:"ACTIVE",currentPeriodEnd:{lte:new Date(Date.now()+2592e5)}}});a>0&&e.push({id:"expiring-subscriptions",type:"warning",title:"Suscripciones por Expirar",message:`${a} suscripciones expiran en los pr\xf3ximos 3 d\xedas`,timestamp:new Date,resolved:!1,metadata:{count:a}});let s=await l._.message.count({where:{createdAt:{gte:new Date(Date.now()-864e5)}}});s<10&&e.push({id:"low-message-activity",type:"warning",title:"Baja Actividad de Mensajes",message:`Solo se han enviado ${s} mensajes en las \xfaltimas 24 horas`,timestamp:new Date,resolved:!1,metadata:{count:s}})}catch(t){e.push({id:"system-error",type:"error",title:"Error del Sistema",message:"Error al generar alertas autom\xe1ticas",timestamp:new Date,resolved:!1,metadata:{error:t instanceof Error?t.message:String(t)}})}return e}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/alerts/route",pathname:"/api/admin/alerts",filename:"route",bundlePath:"app/api/admin/alerts/route"},resolvedPagePath:"/home/ubuntu/comodin_ia/app/app/api/admin/alerts/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:h}=m,w="/api/admin/alerts/route";function v(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4372,7329,1472,7609,1826],()=>r(38755));module.exports=a})();