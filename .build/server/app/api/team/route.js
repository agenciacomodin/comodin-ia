"use strict";(()=>{var e={};e.id=5750,e.ids=[5750],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},23443:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>z,requestAsyncStorage:()=>R,routeModule:()=>m,serverHooks:()=>A,staticGenerationAsyncStorage:()=>N});var n={};t.r(n),t.d(n,{GET:()=>g,POST:()=>I});var a=t(79182),i=t(72007),s=t(56719),o=t(93442),u=t(57978),l=t(11826),d=t(83178),c=t(79591),p=t(25590);async function g(e){try{let r;let t=await (0,u.getServerSession)(l.L);if(!t||!t.user)return o.NextResponse.json({error:"No autorizado"},{status:401});let n=t.user,{searchParams:a}=new URL(e.url),i=a.get("organizationId")||n.organizationId;if(!(0,c.rB)(n,i))return o.NextResponse.json({error:"No tienes acceso a esta organizaci\xf3n"},{status:403});let s=(0,c.p_)(n),g=(r="SUPER_ADMIN"===n.role?await d._.user.findMany({where:"all"===i?{}:{organizationId:i},include:{organization:{select:{id:!0,name:!0,slug:!0,status:!0}}},orderBy:[{role:"desc"},{name:"asc"}]}):"DISTRIBUIDOR"===n.role?await d._.user.findMany({where:{organizationId:{in:s.organizationIds}},include:{organization:{select:{id:!0,name:!0,slug:!0,status:!0}}},orderBy:[{role:"desc"},{name:"asc"}]}):"PROPIETARIO"===n.role?await d._.user.findMany({where:{organizationId:n.organizationId},include:{organization:{select:{id:!0,name:!0,slug:!0,status:!0}}},orderBy:[{role:"desc"},{name:"asc"}]}):await d._.user.findMany({where:{id:n.id},include:{organization:{select:{id:!0,name:!0,slug:!0,status:!0}}}})).map(e=>{let r=(n.permissions?.includes(p.y3.VIEW_ALL_USERS)??!1)||e.id===n.id;return{id:e.id,name:e.name,fullName:e.fullName,email:e.email,role:e.role,isActive:e.isActive,lastLogin:e.lastLogin,createdAt:e.createdAt,organizationId:e.organizationId,organizationName:e.organization.name,organizationStatus:e.organization.status,...r&&{phone:e.phone,country:e.country,timezone:e.timezone,language:e.language,image:e.image}}}),I={total:g.length,active:g.filter(e=>e.isActive).length,byRole:g.reduce((e,r)=>(e[r.role]=(e[r.role]||0)+1,e),{}),recentLogins:g.filter(e=>e.lastLogin&&new Date(e.lastLogin).getTime()>Date.now()-6048e5).length};return o.NextResponse.json({members:g,stats:I,organization:r[0]?.organization||null,userPermissions:{canInviteUsers:n.permissions?.includes(p.y3.INVITE_USERS)??!1,canManageUsers:n.permissions?.includes(p.y3.MANAGE_USERS)??!1,canViewAllUsers:n.permissions?.includes(p.y3.VIEW_ALL_USERS)??!1}})}catch(e){return console.error("Error fetching team members:",e),o.NextResponse.json({error:"Error interno del servidor"},{status:500})}}async function I(e){try{let r=await (0,u.getServerSession)(l.L);if(!r||!r.user)return o.NextResponse.json({error:"No autorizado"},{status:401});let t=r.user;if(!t.permissions?.includes(p.y3.INVITE_USERS))return o.NextResponse.json({error:"No tienes permisos para invitar usuarios"},{status:403});let{email:n,name:a,fullName:i,role:s,organizationId:g}=await e.json();if(!n||!s)return o.NextResponse.json({error:"Email y rol son requeridos"},{status:400});let I=g||t.organizationId;if(!(0,c.rB)(t,I))return o.NextResponse.json({error:"No tienes acceso a esta organizaci\xf3n"},{status:403});if(!((e,r)=>{let t={SUPER_ADMIN:4,DISTRIBUIDOR:3,PROPIETARIO:2,AGENTE:1};return t[e]>=t[r]})(t.role,s))return o.NextResponse.json({error:`No puedes asignar el rol ${s}`},{status:403});if(await d._.user.findUnique({where:{email:n}}))return o.NextResponse.json({error:"Ya existe un usuario con este email"},{status:400});let m=await d._.user.create({data:{email:n,name:a,fullName:i,role:s,organizationId:I,isActive:!0},include:{organization:{select:{name:!0,slug:!0}}}});return o.NextResponse.json({message:"Usuario invitado exitosamente",user:{id:m.id,email:m.email,name:m.name,role:m.role,organizationName:m.organization.name}},{status:201})}catch(e){return console.error("Error inviting user:",e),o.NextResponse.json({error:"Error interno del servidor"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/team/route",pathname:"/api/team",filename:"route",bundlePath:"app/api/team/route"},resolvedPagePath:"/home/ubuntu/comodin_ia/app/app/api/team/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:R,staticGenerationAsyncStorage:N,serverHooks:A}=m,x="/api/team/route";function z(){return(0,s.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:N})}},79591:(e,r,t)=>{var n;function a(e,r){switch(e.role){case"SUPER_ADMIN":case"DISTRIBUIDOR":return!0;case"PROPIETARIO":case"AGENTE":return e.organizationId===r;default:return!1}}function i(e){switch(function(e){switch(e){case"SUPER_ADMIN":return"PLATFORM";case"DISTRIBUIDOR":return"MULTI_TENANT";case"PROPIETARIO":return"ORGANIZATION";default:return"LIMITED"}}(e.role)){case"PLATFORM":return{organizationIds:"ALL",includeSubordinates:!0};case"MULTI_TENANT":return{organizationIds:"SUPER_ADMIN"===e.role?"ALL":[e.organizationId],includeSubordinates:!0};case"ORGANIZATION":return{organizationIds:[e.organizationId],includeSubordinates:!0};default:return{organizationIds:[e.organizationId],userIds:[e.id],includeSubordinates:!1}}}t.d(r,{p_:()=>i,rB:()=>a}),t(25590),!function(e){e.PLATFORM="PLATFORM",e.MULTI_TENANT="MULTI_TENANT",e.ORGANIZATION="ORGANIZATION",e.LIMITED="LIMITED"}(n||(n={}))}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[4372,7329,1472,7609,1826],()=>t(23443));module.exports=n})();