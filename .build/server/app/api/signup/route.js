"use strict";(()=>{var e={};e.id=5409,e.ids=[5409],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},70482:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>z,routeModule:()=>f,serverHooks:()=>q,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{POST:()=>x,dynamic:()=>m});var n=t(79182),i=t(72007),o=t(56719),s=t(93442),u=t(3390),p=t.n(u),l=t(83178),c=t(1507),d=t(91209);let m="force-dynamic",g=d.z.object({email:d.z.string().email("Email inv\xe1lido"),password:d.z.string().min(6,"La contrase\xf1a debe tener al menos 6 caracteres"),fullName:d.z.string().min(2,"El nombre debe tener al menos 2 caracteres"),organizationName:d.z.string().min(2,"El nombre de la organizaci\xf3n debe tener al menos 2 caracteres").optional(),phone:d.z.string().optional(),country:d.z.string().optional()});async function x(e){try{let r=await e.json(),t=g.parse(r);if(await l._.user.findUnique({where:{email:t.email}}))return s.NextResponse.json({error:"El usuario ya existe"},{status:400});let a=t.organizationName||`${t.fullName} Company`,n=await (0,c.Ov)(a),i=await p().hash(t.password,12),o=await l._.$transaction(async e=>{let r=await e.organization.create({data:{name:a,slug:n,country:t.country||"M\xe9xico",status:"TRIAL"}}),o=await e.user.create({data:{email:t.email,name:t.fullName.split(" ")[0],fullName:t.fullName,phone:t.phone,country:t.country||"M\xe9xico",organizationId:r.id,role:"PROPIETARIO"}});return await e.account.create({data:{userId:o.id,type:"credentials",provider:"credentials",providerAccountId:o.id,refresh_token:i}}),{user:o,organization:r}});return s.NextResponse.json({message:"Registro exitoso",user:{id:o.user.id,email:o.user.email,fullName:o.user.fullName,organizationId:o.organization.id,organizationName:o.organization.name,role:o.user.role}},{status:201})}catch(e){if(console.error("Error en registro:",e),e instanceof d.z.ZodError)return s.NextResponse.json({error:"Datos inv\xe1lidos",details:e.errors},{status:400});return s.NextResponse.json({error:"Error interno del servidor"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/signup/route",pathname:"/api/signup",filename:"route",bundlePath:"app/api/signup/route"},resolvedPagePath:"/home/ubuntu/comodin_ia/app/app/api/signup/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:z,staticGenerationAsyncStorage:h,serverHooks:q}=f,y="/api/signup/route";function w(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:h})}},1507:(e,r,t)=>{t.d(r,{BN:()=>o,Ov:()=>s});var a=t(57978),n=t(11826),i=t(83178);async function o(){let e=await (0,a.getServerSession)(n.L);if(!e?.user?.organizationId)throw Error("Usuario no autenticado o sin organizaci\xf3n");let r=await i._.organization.findUnique({where:{id:e.user.organizationId,status:{not:"SUSPENDED"}},include:{users:!0}});if(!r)throw Error("Organizaci\xf3n no encontrada o suspendida");return{organization:r,user:e.user}}async function s(e){let r=e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),t=r,a=1;for(;;){if(!await i._.organization.findUnique({where:{slug:t}}))return t;t=`${r}-${a}`,a++}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[4372,7329,1472,7609,1209,1826],()=>t(70482));module.exports=a})();