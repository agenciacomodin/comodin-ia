"use strict";exports.id=1826,exports.ids=[1826],exports.modules={11826:(E,A,_)=>{_.d(A,{G:()=>R,L:()=>M});var N=_(57978),I=_(66291),S=_(64617),T=_(83178),O=_(3390),C=_.n(O),G=_(25590);let M={adapter:(0,S.N)(T._),session:{strategy:"jwt"},providers:[(0,I.Z)({id:"credentials",name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(E){if(!E?.email||!E?.password)throw Error("Credenciales incompletas");let A=await T._.user.findUnique({where:{email:E.email},include:{organization:!0}});if(!A)throw Error("Usuario no encontrado");if(!A.isActive)throw Error("Usuario inactivo");if("SUSPENDED"===A.organization.status||"INACTIVE"===A.organization.status)throw Error("Organizaci\xf3n suspendida o inactiva");let _=await T._.account.findFirst({where:{userId:A.id,provider:"credentials"}});if(!_?.refresh_token)throw Error("M\xe9todo de autenticaci\xf3n no v\xe1lido");if(!await C().compare(E.password,_.refresh_token))throw Error("Contrase\xf1a incorrecta");return await T._.user.update({where:{id:A.id},data:{lastLogin:new Date}}),{id:A.id,email:A.email,name:A.name,image:A.image,organizationId:A.organizationId,role:A.role,fullName:A.fullName,phone:A.phone,country:A.country,permissions:(0,G.ai)(A.role).map(E=>E.toString())}}}),(0,I.Z)({id:"qr-auth",name:"QR Authentication",credentials:{sessionId:{label:"Session ID",type:"text"},authToken:{label:"Auth Token",type:"text"}},async authorize(E){if(!E?.sessionId||!E?.authToken)throw Error("Datos de autenticaci\xf3n QR incompletos");try{let A=await fetch(`${process.env.NEXTAUTH_URL}/api/auth/qr/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:E.sessionId,authToken:E.authToken})}),_=await A.json();if(!_.success||!_.data.user)throw Error("Token QR no v\xe1lido");let N=_.data.user;return{id:N.id,email:N.email,name:N.name,image:N.image,organizationId:N.organizationId,role:N.role,fullName:N.fullName,phone:N.phone,country:N.country,permissions:(0,G.ai)(N.role).map(E=>E.toString())}}catch(E){throw console.error("QR Auth error:",E),Error("Error en autenticaci\xf3n QR")}}})],callbacks:{jwt:async({token:E,user:A})=>(A&&(E.organizationId=A.organizationId,E.role=A.role,E.fullName=A.fullName,E.phone=A.phone,E.country=A.country,E.permissions=A.permissions),E),session:async({session:E,token:A})=>(A&&E.user&&(E.user.id=A.sub,E.user.organizationId=A.organizationId,E.user.role=A.role,E.user.fullName=A.fullName,E.user.phone=A.phone,E.user.country=A.country,E.user.permissions=A.permissions),E),redirect:async({url:E,baseUrl:A})=>E===A||E.startsWith(A+"/auth")?A+"/dashboard":E},pages:{signIn:"/auth/login"},events:{async signIn({user:E,account:A,profile:_,isNewUser:N}){console.log(`âœ… Usuario iniciado sesi\xf3n: ${E.email}`)}}};async function R(){return await (0,N.getServerSession)(M)}},83178:(E,A,_)=>{_.d(A,{_:()=>I,db:()=>S});var N=_(53524);let I=globalThis.prisma??new N.PrismaClient,S=I},25590:(E,A,_)=>{var N;function I(E){switch(E){case"SUPER_ADMIN":return["MANAGE_AI_PROVIDERS","VIEW_SYSTEM_ANALYTICS","MANAGE_SYSTEM_SETTINGS","VIEW_ALL_ORGANIZATIONS","SUSPEND_ORGANIZATIONS","PLATFORM_ADMINISTRATION","VIEW_ALL_CONVERSATIONS","MANAGE_CLIENT_ORGANIZATIONS","VIEW_DASHBOARD","VIEW_CRM_INBOX","MANAGE_CRM_CONVERSATIONS","MANAGE_CRM_CONTACTS","VIEW_CRM_ANALYTICS","EXPORT_CRM_DATA","VIEW_CONTACTS","MANAGE_CONTACTS","VIEW_FOLLOW_UPS","CREATE_FOLLOW_UP_SEQUENCES","MANAGE_FOLLOW_UP_SEQUENCES","EXECUTE_FOLLOW_UPS","VIEW_WHATSAPP_CHANNELS","MANAGE_WHATSAPP_CHANNELS","CONNECT_WHATSAPP_QR","CONNECT_WHATSAPP_API","CONFIGURE_WHATSAPP_SETTINGS","VIEW_QUICK_REPLIES","MANAGE_QUICK_REPLIES","MANAGE_GLOBAL_QUICK_REPLIES","VIEW_AUTOMATIONS","MANAGE_AUTOMATIONS","VIEW_AUTOMATION_ANALYTICS","VIEW_KNOWLEDGE_BASE","MANAGE_KNOWLEDGE_BASE","UPLOAD_KNOWLEDGE_SOURCES","MANAGE_KNOWLEDGE_SOURCES","DELETE_KNOWLEDGE_SOURCES","VIEW_INTEGRATIONS","MANAGE_INTEGRATIONS","CONFIGURE_ECOMMERCE","CONNECT_INTEGRATIONS","DISCONNECT_INTEGRATIONS","CONFIGURE_INTEGRATION_SETTINGS","VIEW_CAMPAIGNS","MANAGE_CAMPAIGNS","CREATE_CAMPAIGNS","EXECUTE_CAMPAIGNS","PAUSE_CAMPAIGNS","SEND_BULK_MESSAGES","VIEW_CAMPAIGN_ANALYTICS","USE_AUDIENCE_BUILDER","VIEW_MESSAGE_TEMPLATES","CREATE_MESSAGE_TEMPLATES","MANAGE_MESSAGE_TEMPLATES","SYNC_META_TEMPLATES","DELETE_MESSAGE_TEMPLATES","VIEW_REPORTS","EXPORT_REPORTS","VIEW_ADVANCED_ANALYTICS","VIEW_TEAM_MEMBERS","INVITE_TEAM_MEMBERS","MANAGE_TEAM_ROLES","REMOVE_TEAM_MEMBERS","VIEW_ALL_USERS","INVITE_USERS","MANAGE_USERS","VIEW_BILLING","MANAGE_BILLING","VIEW_USAGE_ANALYTICS","MANAGE_AI_WALLET","MANAGE_WALLET","VIEW_TRANSACTIONS","RECHARGE_WALLET","VIEW_ORGANIZATION_SETTINGS","MANAGE_ORGANIZATION_SETTINGS","EXPORT_ORGANIZATION_DATA","MANAGE_ORGANIZATION","CREATE_CLIENT_ACCOUNTS"];case"PROPIETARIO":return["VIEW_DASHBOARD","VIEW_CRM_INBOX","MANAGE_CRM_CONVERSATIONS","MANAGE_CRM_CONTACTS","VIEW_CRM_ANALYTICS","EXPORT_CRM_DATA","VIEW_CONTACTS","MANAGE_CONTACTS","VIEW_FOLLOW_UPS","CREATE_FOLLOW_UP_SEQUENCES","MANAGE_FOLLOW_UP_SEQUENCES","EXECUTE_FOLLOW_UPS","VIEW_WHATSAPP_CHANNELS","MANAGE_WHATSAPP_CHANNELS","CONNECT_WHATSAPP_QR","CONNECT_WHATSAPP_API","CONFIGURE_WHATSAPP_SETTINGS","VIEW_QUICK_REPLIES","MANAGE_QUICK_REPLIES","MANAGE_GLOBAL_QUICK_REPLIES","VIEW_AUTOMATIONS","MANAGE_AUTOMATIONS","VIEW_AUTOMATION_ANALYTICS","VIEW_KNOWLEDGE_BASE","MANAGE_KNOWLEDGE_BASE","UPLOAD_KNOWLEDGE_SOURCES","MANAGE_KNOWLEDGE_SOURCES","DELETE_KNOWLEDGE_SOURCES","VIEW_INTEGRATIONS","MANAGE_INTEGRATIONS","CONFIGURE_ECOMMERCE","CONNECT_INTEGRATIONS","DISCONNECT_INTEGRATIONS","CONFIGURE_INTEGRATION_SETTINGS","VIEW_CAMPAIGNS","MANAGE_CAMPAIGNS","CREATE_CAMPAIGNS","EXECUTE_CAMPAIGNS","PAUSE_CAMPAIGNS","SEND_BULK_MESSAGES","VIEW_CAMPAIGN_ANALYTICS","USE_AUDIENCE_BUILDER","VIEW_MESSAGE_TEMPLATES","CREATE_MESSAGE_TEMPLATES","MANAGE_MESSAGE_TEMPLATES","SYNC_META_TEMPLATES","DELETE_MESSAGE_TEMPLATES","VIEW_REPORTS","EXPORT_REPORTS","VIEW_ADVANCED_ANALYTICS","VIEW_TEAM_MEMBERS","INVITE_TEAM_MEMBERS","MANAGE_TEAM_ROLES","REMOVE_TEAM_MEMBERS","VIEW_ALL_USERS","INVITE_USERS","MANAGE_USERS","VIEW_BILLING","MANAGE_BILLING","VIEW_USAGE_ANALYTICS","MANAGE_AI_WALLET","MANAGE_WALLET","VIEW_TRANSACTIONS","RECHARGE_WALLET","VIEW_ORGANIZATION_SETTINGS","MANAGE_ORGANIZATION_SETTINGS","EXPORT_ORGANIZATION_DATA","MANAGE_ORGANIZATION","CREATE_CLIENT_ACCOUNTS","DELETE_CAMPAIGNS","VIEW_AUDIENCE_PREVIEW","VIEW_ASSIGNED_CONVERSATIONS","VIEW_ALL_CONVERSATIONS","MANAGE_WHATSAPP_CONFIG","CONFIGURE_AI"];case"DISTRIBUIDOR":return["VIEW_DASHBOARD","VIEW_CRM_INBOX","MANAGE_CRM_CONVERSATIONS","MANAGE_CRM_CONTACTS","VIEW_CRM_ANALYTICS","EXPORT_CRM_DATA","VIEW_CONTACTS","MANAGE_CONTACTS","VIEW_FOLLOW_UPS","CREATE_FOLLOW_UP_SEQUENCES","EXECUTE_FOLLOW_UPS","VIEW_WHATSAPP_CHANNELS","CONNECT_WHATSAPP_QR","CONFIGURE_WHATSAPP_SETTINGS","VIEW_QUICK_REPLIES","MANAGE_QUICK_REPLIES","VIEW_AUTOMATIONS","VIEW_AUTOMATION_ANALYTICS","VIEW_KNOWLEDGE_BASE","UPLOAD_KNOWLEDGE_SOURCES","MANAGE_KNOWLEDGE_SOURCES","VIEW_INTEGRATIONS","CONNECT_INTEGRATIONS","VIEW_CAMPAIGNS","MANAGE_CAMPAIGNS","CREATE_CAMPAIGNS","EXECUTE_CAMPAIGNS","SEND_BULK_MESSAGES","VIEW_CAMPAIGN_ANALYTICS","USE_AUDIENCE_BUILDER","VIEW_MESSAGE_TEMPLATES","CREATE_MESSAGE_TEMPLATES","MANAGE_MESSAGE_TEMPLATES","VIEW_REPORTS","EXPORT_REPORTS","VIEW_TEAM_MEMBERS","VIEW_ALL_USERS","VIEW_BILLING","VIEW_USAGE_ANALYTICS","VIEW_TRANSACTIONS","VIEW_ORGANIZATION_SETTINGS","VIEW_AUDIENCE_PREVIEW","VIEW_ASSIGNED_CONVERSATIONS","MANAGE_CLIENT_ORGANIZATIONS"];default:return["VIEW_DASHBOARD","VIEW_CRM_INBOX","MANAGE_CRM_CONVERSATIONS","VIEW_CRM_ANALYTICS","VIEW_CONTACTS","VIEW_FOLLOW_UPS","EXECUTE_FOLLOW_UPS","VIEW_WHATSAPP_CHANNELS","VIEW_QUICK_REPLIES","MANAGE_QUICK_REPLIES","VIEW_AUTOMATIONS","VIEW_KNOWLEDGE_BASE","VIEW_CAMPAIGNS","VIEW_CAMPAIGN_ANALYTICS","VIEW_MESSAGE_TEMPLATES","VIEW_REPORTS","VIEW_ORGANIZATION_SETTINGS","VIEW_BILLING","VIEW_USAGE_ANALYTICS","VIEW_ASSIGNED_CONVERSATIONS"]}}function S(E,A){return E.includes(A.toString())}function T(E,A){return S(I(E).map(E=>E.toString()),A)}_.d(A,{Fs:()=>S,N$:()=>T,ai:()=>I,y3:()=>N}),function(E){E.VIEW_DASHBOARD="VIEW_DASHBOARD",E.VIEW_CRM_INBOX="VIEW_CRM_INBOX",E.MANAGE_CRM_CONVERSATIONS="MANAGE_CRM_CONVERSATIONS",E.MANAGE_CRM_CONTACTS="MANAGE_CRM_CONTACTS",E.VIEW_CRM_ANALYTICS="VIEW_CRM_ANALYTICS",E.EXPORT_CRM_DATA="EXPORT_CRM_DATA",E.VIEW_CONTACTS="VIEW_CONTACTS",E.MANAGE_CONTACTS="MANAGE_CONTACTS",E.VIEW_FOLLOW_UPS="VIEW_FOLLOW_UPS",E.CREATE_FOLLOW_UP_SEQUENCES="CREATE_FOLLOW_UP_SEQUENCES",E.MANAGE_FOLLOW_UP_SEQUENCES="MANAGE_FOLLOW_UP_SEQUENCES",E.EXECUTE_FOLLOW_UPS="EXECUTE_FOLLOW_UPS",E.VIEW_WHATSAPP_CHANNELS="VIEW_WHATSAPP_CHANNELS",E.MANAGE_WHATSAPP_CHANNELS="MANAGE_WHATSAPP_CHANNELS",E.CONNECT_WHATSAPP_QR="CONNECT_WHATSAPP_QR",E.CONNECT_WHATSAPP_API="CONNECT_WHATSAPP_API",E.CONFIGURE_WHATSAPP_SETTINGS="CONFIGURE_WHATSAPP_SETTINGS",E.VIEW_QUICK_REPLIES="VIEW_QUICK_REPLIES",E.MANAGE_QUICK_REPLIES="MANAGE_QUICK_REPLIES",E.MANAGE_GLOBAL_QUICK_REPLIES="MANAGE_GLOBAL_QUICK_REPLIES",E.VIEW_AUTOMATIONS="VIEW_AUTOMATIONS",E.MANAGE_AUTOMATIONS="MANAGE_AUTOMATIONS",E.VIEW_AUTOMATION_ANALYTICS="VIEW_AUTOMATION_ANALYTICS",E.VIEW_KNOWLEDGE_BASE="VIEW_KNOWLEDGE_BASE",E.MANAGE_KNOWLEDGE_BASE="MANAGE_KNOWLEDGE_BASE",E.UPLOAD_KNOWLEDGE_SOURCES="UPLOAD_KNOWLEDGE_SOURCES",E.MANAGE_KNOWLEDGE_SOURCES="MANAGE_KNOWLEDGE_SOURCES",E.DELETE_KNOWLEDGE_SOURCES="DELETE_KNOWLEDGE_SOURCES",E.VIEW_INTEGRATIONS="VIEW_INTEGRATIONS",E.MANAGE_INTEGRATIONS="MANAGE_INTEGRATIONS",E.CONFIGURE_ECOMMERCE="CONFIGURE_ECOMMERCE",E.CONNECT_INTEGRATIONS="CONNECT_INTEGRATIONS",E.DISCONNECT_INTEGRATIONS="DISCONNECT_INTEGRATIONS",E.CONFIGURE_INTEGRATION_SETTINGS="CONFIGURE_INTEGRATION_SETTINGS",E.VIEW_CAMPAIGNS="VIEW_CAMPAIGNS",E.MANAGE_CAMPAIGNS="MANAGE_CAMPAIGNS",E.CREATE_CAMPAIGNS="CREATE_CAMPAIGNS",E.EXECUTE_CAMPAIGNS="EXECUTE_CAMPAIGNS",E.PAUSE_CAMPAIGNS="PAUSE_CAMPAIGNS",E.SEND_BULK_MESSAGES="SEND_BULK_MESSAGES",E.VIEW_CAMPAIGN_ANALYTICS="VIEW_CAMPAIGN_ANALYTICS",E.USE_AUDIENCE_BUILDER="USE_AUDIENCE_BUILDER",E.VIEW_MESSAGE_TEMPLATES="VIEW_MESSAGE_TEMPLATES",E.CREATE_MESSAGE_TEMPLATES="CREATE_MESSAGE_TEMPLATES",E.MANAGE_MESSAGE_TEMPLATES="MANAGE_MESSAGE_TEMPLATES",E.SYNC_META_TEMPLATES="SYNC_META_TEMPLATES",E.DELETE_MESSAGE_TEMPLATES="DELETE_MESSAGE_TEMPLATES",E.VIEW_REPORTS="VIEW_REPORTS",E.EXPORT_REPORTS="EXPORT_REPORTS",E.VIEW_ADVANCED_ANALYTICS="VIEW_ADVANCED_ANALYTICS",E.VIEW_TEAM_MEMBERS="VIEW_TEAM_MEMBERS",E.INVITE_TEAM_MEMBERS="INVITE_TEAM_MEMBERS",E.MANAGE_TEAM_ROLES="MANAGE_TEAM_ROLES",E.REMOVE_TEAM_MEMBERS="REMOVE_TEAM_MEMBERS",E.VIEW_ALL_USERS="VIEW_ALL_USERS",E.INVITE_USERS="INVITE_USERS",E.MANAGE_USERS="MANAGE_USERS",E.VIEW_BILLING="VIEW_BILLING",E.MANAGE_BILLING="MANAGE_BILLING",E.VIEW_USAGE_ANALYTICS="VIEW_USAGE_ANALYTICS",E.MANAGE_AI_WALLET="MANAGE_AI_WALLET",E.MANAGE_WALLET="MANAGE_WALLET",E.VIEW_TRANSACTIONS="VIEW_TRANSACTIONS",E.RECHARGE_WALLET="RECHARGE_WALLET",E.VIEW_ORGANIZATION_SETTINGS="VIEW_ORGANIZATION_SETTINGS",E.MANAGE_ORGANIZATION_SETTINGS="MANAGE_ORGANIZATION_SETTINGS",E.EXPORT_ORGANIZATION_DATA="EXPORT_ORGANIZATION_DATA",E.MANAGE_ORGANIZATION="MANAGE_ORGANIZATION",E.CREATE_CLIENT_ACCOUNTS="CREATE_CLIENT_ACCOUNTS",E.MANAGE_AI_PROVIDERS="MANAGE_AI_PROVIDERS",E.VIEW_SYSTEM_ANALYTICS="VIEW_SYSTEM_ANALYTICS",E.MANAGE_SYSTEM_SETTINGS="MANAGE_SYSTEM_SETTINGS",E.VIEW_ALL_ORGANIZATIONS="VIEW_ALL_ORGANIZATIONS",E.SUSPEND_ORGANIZATIONS="SUSPEND_ORGANIZATIONS",E.PLATFORM_ADMINISTRATION="PLATFORM_ADMINISTRATION",E.DELETE_CAMPAIGNS="DELETE_CAMPAIGNS",E.VIEW_AUDIENCE_PREVIEW="VIEW_AUDIENCE_PREVIEW",E.VIEW_ASSIGNED_CONVERSATIONS="VIEW_ASSIGNED_CONVERSATIONS",E.VIEW_ALL_CONVERSATIONS="VIEW_ALL_CONVERSATIONS",E.MANAGE_CLIENT_ORGANIZATIONS="MANAGE_CLIENT_ORGANIZATIONS",E.MANAGE_WHATSAPP_CONFIG="MANAGE_WHATSAPP_CONFIG",E.CONFIGURE_AI="CONFIGURE_AI"}(N||(N={}))}};