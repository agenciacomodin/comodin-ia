"use strict";exports.id=2914,exports.ids=[2914],exports.modules={71199:(E,A,_)=>{_.d(A,{QO:()=>t,Rf:()=>O});var N=_(57978),I=_(11826),S=_(25590),e=_(83178);async function T(E){let A=await (0,N.getServerSession)(I.L);if(!A?.user)throw Error("No autenticado");let{organizationId:_,userRole:S,userId:e,userEmail:T}=function(E){let A=E.headers.get("x-organization-id");return{organizationId:A,userRole:E.headers.get("x-user-role"),userId:E.headers.get("x-user-id"),userEmail:E.headers.get("x-user-email")}}(E);if(!_||!S||!e)throw Error("Informaci\xf3n de autenticaci\xf3n incompleta");return{user:A.user,organizationId:_,userRole:S,userId:e,userEmail:T}}async function r(E,A){let _=await T(E);if(!A.some(E=>(0,S.Fs)(_.userRole,E)))throw Error("Permisos insuficientes");return _}async function C(E,A){return!!await e._.user.findFirst({where:{id:E,organizationId:A,isActive:!0}})}function t(E,A=[]){return async(_,...N)=>{try{let I=A.length>0?await r(_,A):await T(_);if(!await C(I.userId,I.organizationId))return Response.json({error:"Acceso no autorizado a esta organizaci\xf3n"},{status:403});return await E(_,I,...N)}catch(E){if("No autenticado"===E.message)return Response.json({error:"No autenticado"},{status:401});if("Permisos insuficientes"===E.message)return Response.json({error:"Permisos insuficientes"},{status:403});return Response.json({error:"Error interno del servidor"},{status:500})}}}let O={success:(E,A=200)=>Response.json({success:!0,data:E},{status:A}),error:(E,A=400,_)=>Response.json({success:!1,error:E,..._&&{details:_}},{status:A}),unauthorized:(E="No autorizado")=>Response.json({success:!1,error:E},{status:401}),forbidden:(E="Acceso denegado")=>Response.json({success:!1,error:E},{status:403}),notFound:(E="Recurso no encontrado")=>Response.json({success:!1,error:E},{status:404})}},11826:(E,A,_)=>{_.d(A,{L:()=>C});var N=_(66291),I=_(64617),S=_(83178),e=_(3390),T=_.n(e),r=_(25590);let C={adapter:(0,I.N)(S._),session:{strategy:"jwt"},providers:[(0,N.Z)({id:"credentials",name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(E){if(!E?.email||!E?.password)throw Error("Credenciales incompletas");let A=await S._.user.findUnique({where:{email:E.email},include:{organization:!0}});if(!A)throw Error("Usuario no encontrado");if(!A.isActive)throw Error("Usuario inactivo");if("SUSPENDED"===A.organization.status||"INACTIVE"===A.organization.status)throw Error("Organizaci\xf3n suspendida o inactiva");let _=await S._.account.findFirst({where:{userId:A.id,provider:"credentials"}});if(!_?.refresh_token)throw Error("M\xe9todo de autenticaci\xf3n no v\xe1lido");if(!await T().compare(E.password,_.refresh_token))throw Error("Contrase\xf1a incorrecta");return await S._.user.update({where:{id:A.id},data:{lastLogin:new Date}}),{id:A.id,email:A.email,name:A.name,image:A.image,organizationId:A.organizationId,role:A.role,fullName:A.fullName,phone:A.phone,country:A.country,permissions:(0,r.ai)(A.role).map(E=>E.toString())}}})],callbacks:{jwt:async({token:E,user:A})=>(A&&(E.organizationId=A.organizationId,E.role=A.role,E.fullName=A.fullName,E.phone=A.phone,E.country=A.country,E.permissions=A.permissions),E),session:async({session:E,token:A})=>(A&&E.user&&(E.user.id=A.sub,E.user.organizationId=A.organizationId,E.user.role=A.role,E.user.fullName=A.fullName,E.user.phone=A.phone,E.user.country=A.country,E.user.permissions=A.permissions),E),redirect:async({url:E,baseUrl:A})=>E===A||E.startsWith(A+"/auth")?A+"/dashboard":E},pages:{signIn:"/auth/login"},events:{async signIn({user:E,account:A,profile:_,isNewUser:N}){console.log(`âœ… Usuario iniciado sesi\xf3n: ${E.email}`)}}}},83178:(E,A,_)=>{_.d(A,{_:()=>I,db:()=>S});var N=_(53524);let I=globalThis.prisma??new N.PrismaClient,S=I},25590:(E,A,_)=>{var N;_.d(A,{Fs:()=>S,ai:()=>e,y3:()=>N}),function(E){E.MANAGE_ORGANIZATION="MANAGE_ORGANIZATION",E.VIEW_ORGANIZATION_SETTINGS="VIEW_ORGANIZATION_SETTINGS",E.MANAGE_USERS="MANAGE_USERS",E.INVITE_USERS="INVITE_USERS",E.VIEW_ALL_USERS="VIEW_ALL_USERS",E.VIEW_ALL_CONVERSATIONS="VIEW_ALL_CONVERSATIONS",E.VIEW_ASSIGNED_CONVERSATIONS="VIEW_ASSIGNED_CONVERSATIONS",E.MANAGE_CONVERSATIONS="MANAGE_CONVERSATIONS",E.ASSIGN_CONVERSATIONS="ASSIGN_CONVERSATIONS",E.MANAGE_WHATSAPP_CONFIG="MANAGE_WHATSAPP_CONFIG",E.VIEW_WHATSAPP_SETTINGS="VIEW_WHATSAPP_SETTINGS",E.MANAGE_BILLING="MANAGE_BILLING",E.VIEW_BILLING="VIEW_BILLING",E.CONFIGURE_AI="CONFIGURE_AI",E.USE_AI_FEATURES="USE_AI_FEATURES",E.VIEW_AI_USAGE="VIEW_AI_USAGE",E.USE_AI_BROKER="USE_AI_BROKER",E.VIEW_AI_BROKER_STATS="VIEW_AI_BROKER_STATS",E.VIEW_REPORTS="VIEW_REPORTS",E.VIEW_ADVANCED_ANALYTICS="VIEW_ADVANCED_ANALYTICS",E.VIEW_CONTACTS="VIEW_CONTACTS",E.MANAGE_CONTACTS="MANAGE_CONTACTS",E.CREATE_CONTACTS="CREATE_CONTACTS",E.DELETE_CONTACTS="DELETE_CONTACTS",E.VIEW_CRM_INBOX="VIEW_CRM_INBOX",E.MANAGE_CRM_CONVERSATIONS="MANAGE_CRM_CONVERSATIONS",E.SEND_MESSAGES="SEND_MESSAGES",E.VIEW_ALL_CRM_CONVERSATIONS="VIEW_ALL_CRM_CONVERSATIONS",E.ASSIGN_CRM_CONVERSATIONS="ASSIGN_CRM_CONVERSATIONS",E.MANAGE_CONTACT_TAGS="MANAGE_CONTACT_TAGS",E.VIEW_CONTACT_NOTES="VIEW_CONTACT_NOTES",E.MANAGE_CONTACT_NOTES="MANAGE_CONTACT_NOTES",E.TRANSFER_CONVERSATIONS="TRANSFER_CONVERSATIONS",E.MANAGE_WHATSAPP_CHANNELS="MANAGE_WHATSAPP_CHANNELS",E.VIEW_WHATSAPP_CHANNELS="VIEW_WHATSAPP_CHANNELS",E.CREATE_WHATSAPP_CHANNELS="CREATE_WHATSAPP_CHANNELS",E.DELETE_WHATSAPP_CHANNELS="DELETE_WHATSAPP_CHANNELS",E.CONFIGURE_QR_CONNECTION="CONFIGURE_QR_CONNECTION",E.CONFIGURE_API_CONNECTION="CONFIGURE_API_CONNECTION",E.MANAGE_QUICK_REPLIES="MANAGE_QUICK_REPLIES",E.VIEW_QUICK_REPLIES="VIEW_QUICK_REPLIES",E.CREATE_QUICK_REPLIES="CREATE_QUICK_REPLIES",E.DELETE_QUICK_REPLIES="DELETE_QUICK_REPLIES",E.USE_QUICK_REPLIES="USE_QUICK_REPLIES",E.VIEW_ALL_QUICK_REPLIES="VIEW_ALL_QUICK_REPLIES",E.MANAGE_KNOWLEDGE_BASE="MANAGE_KNOWLEDGE_BASE",E.VIEW_KNOWLEDGE_BASE="VIEW_KNOWLEDGE_BASE",E.MANAGE_ORGANIZATION_SETTINGS="MANAGE_ORGANIZATION_SETTINGS",E.MANAGE_CLIENT_ORGANIZATIONS="MANAGE_CLIENT_ORGANIZATIONS",E.VIEW_COMMISSIONS="VIEW_COMMISSIONS",E.CREATE_CLIENT_ACCOUNTS="CREATE_CLIENT_ACCOUNTS",E.PLATFORM_ADMINISTRATION="PLATFORM_ADMINISTRATION",E.VIEW_ALL_ORGANIZATIONS="VIEW_ALL_ORGANIZATIONS",E.MANAGE_SYSTEM_SETTINGS="MANAGE_SYSTEM_SETTINGS",E.MANAGE_AI_PROVIDERS="MANAGE_AI_PROVIDERS",E.VIEW_INTEGRATIONS="VIEW_INTEGRATIONS",E.MANAGE_INTEGRATIONS="MANAGE_INTEGRATIONS",E.CONNECT_INTEGRATIONS="CONNECT_INTEGRATIONS",E.DISCONNECT_INTEGRATIONS="DISCONNECT_INTEGRATIONS",E.VIEW_INTEGRATION_LOGS="VIEW_INTEGRATION_LOGS",E.CONFIGURE_INTEGRATION_SETTINGS="CONFIGURE_INTEGRATION_SETTINGS",E.VIEW_CAMPAIGNS="VIEW_CAMPAIGNS",E.MANAGE_CAMPAIGNS="MANAGE_CAMPAIGNS",E.CREATE_CAMPAIGNS="CREATE_CAMPAIGNS",E.DELETE_CAMPAIGNS="DELETE_CAMPAIGNS",E.EXECUTE_CAMPAIGNS="EXECUTE_CAMPAIGNS",E.PAUSE_CAMPAIGNS="PAUSE_CAMPAIGNS",E.VIEW_CAMPAIGN_ANALYTICS="VIEW_CAMPAIGN_ANALYTICS",E.VIEW_MESSAGE_TEMPLATES="VIEW_MESSAGE_TEMPLATES",E.MANAGE_MESSAGE_TEMPLATES="MANAGE_MESSAGE_TEMPLATES",E.CREATE_MESSAGE_TEMPLATES="CREATE_MESSAGE_TEMPLATES",E.DELETE_MESSAGE_TEMPLATES="DELETE_MESSAGE_TEMPLATES",E.SYNC_META_TEMPLATES="SYNC_META_TEMPLATES",E.USE_AUDIENCE_BUILDER="USE_AUDIENCE_BUILDER",E.VIEW_AUDIENCE_PREVIEW="VIEW_AUDIENCE_PREVIEW",E.MANAGE_AUDIENCE_FILTERS="MANAGE_AUDIENCE_FILTERS",E.VIEW_SENDING_QUEUE="VIEW_SENDING_QUEUE",E.MANAGE_SENDING_SETTINGS="MANAGE_SENDING_SETTINGS"}(N||(N={}));let I={SUPER_ADMIN:[...Object.values(N)],DISTRIBUIDOR:["MANAGE_CLIENT_ORGANIZATIONS","VIEW_COMMISSIONS","CREATE_CLIENT_ACCOUNTS","VIEW_ORGANIZATION_SETTINGS","VIEW_BILLING","VIEW_REPORTS","USE_AI_FEATURES","VIEW_AI_USAGE","USE_AI_BROKER","VIEW_ALL_CONVERSATIONS","MANAGE_CONVERSATIONS"],PROPIETARIO:["MANAGE_ORGANIZATION","VIEW_ORGANIZATION_SETTINGS","MANAGE_ORGANIZATION_SETTINGS","MANAGE_USERS","INVITE_USERS","VIEW_ALL_USERS","VIEW_ALL_CONVERSATIONS","MANAGE_CONVERSATIONS","ASSIGN_CONVERSATIONS","MANAGE_WHATSAPP_CONFIG","VIEW_WHATSAPP_SETTINGS","MANAGE_BILLING","VIEW_BILLING","CONFIGURE_AI","USE_AI_FEATURES","VIEW_AI_USAGE","USE_AI_BROKER","VIEW_AI_BROKER_STATS","VIEW_REPORTS","VIEW_ADVANCED_ANALYTICS","MANAGE_CAMPAIGNS","VIEW_CAMPAIGNS","VIEW_CONTACTS","MANAGE_CONTACTS","CREATE_CONTACTS","DELETE_CONTACTS","VIEW_CRM_INBOX","MANAGE_CRM_CONVERSATIONS","SEND_MESSAGES","VIEW_ALL_CRM_CONVERSATIONS","ASSIGN_CRM_CONVERSATIONS","MANAGE_CONTACT_TAGS","VIEW_CONTACT_NOTES","MANAGE_CONTACT_NOTES","TRANSFER_CONVERSATIONS","MANAGE_WHATSAPP_CHANNELS","VIEW_WHATSAPP_CHANNELS","CREATE_WHATSAPP_CHANNELS","DELETE_WHATSAPP_CHANNELS","CONFIGURE_QR_CONNECTION","CONFIGURE_API_CONNECTION","MANAGE_QUICK_REPLIES","VIEW_QUICK_REPLIES","CREATE_QUICK_REPLIES","DELETE_QUICK_REPLIES","USE_QUICK_REPLIES","VIEW_ALL_QUICK_REPLIES","MANAGE_KNOWLEDGE_BASE","VIEW_KNOWLEDGE_BASE","VIEW_INTEGRATIONS","MANAGE_INTEGRATIONS","CONNECT_INTEGRATIONS","DISCONNECT_INTEGRATIONS","VIEW_INTEGRATION_LOGS","CONFIGURE_INTEGRATION_SETTINGS","VIEW_CAMPAIGNS","MANAGE_CAMPAIGNS","CREATE_CAMPAIGNS","DELETE_CAMPAIGNS","EXECUTE_CAMPAIGNS","PAUSE_CAMPAIGNS","VIEW_CAMPAIGN_ANALYTICS","VIEW_MESSAGE_TEMPLATES","MANAGE_MESSAGE_TEMPLATES","CREATE_MESSAGE_TEMPLATES","DELETE_MESSAGE_TEMPLATES","SYNC_META_TEMPLATES","USE_AUDIENCE_BUILDER","VIEW_AUDIENCE_PREVIEW","MANAGE_AUDIENCE_FILTERS","VIEW_SENDING_QUEUE","MANAGE_SENDING_SETTINGS"],AGENTE:["VIEW_ASSIGNED_CONVERSATIONS","USE_AI_FEATURES","USE_AI_BROKER","VIEW_WHATSAPP_SETTINGS","VIEW_CONTACTS","VIEW_KNOWLEDGE_BASE","VIEW_CAMPAIGNS","VIEW_CRM_INBOX","SEND_MESSAGES","VIEW_CONTACT_NOTES","MANAGE_CONTACT_NOTES","USE_QUICK_REPLIES","VIEW_QUICK_REPLIES","VIEW_CAMPAIGNS","VIEW_MESSAGE_TEMPLATES"]};function S(E,A){return I[E].includes(A)}function e(E){return I[E]}},23926:(E,A)=>{Object.defineProperty(A,"__esModule",{value:!0})},57978:(E,A,_)=>{Object.defineProperty(A,"__esModule",{value:!0});var N={};Object.defineProperty(A,"default",{enumerable:!0,get:function(){return S.default}});var I=_(23926);Object.keys(I).forEach(function(E){!("default"===E||"__esModule"===E||Object.prototype.hasOwnProperty.call(N,E))&&(E in A&&A[E]===I[E]||Object.defineProperty(A,E,{enumerable:!0,get:function(){return I[E]}}))});var S=function(E,A){if(E&&E.__esModule)return E;if(null===E||"object"!=typeof E&&"function"!=typeof E)return{default:E};var _=e(void 0);if(_&&_.has(E))return _.get(E);var N={__proto__:null},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var S in E)if("default"!==S&&({}).hasOwnProperty.call(E,S)){var T=I?Object.getOwnPropertyDescriptor(E,S):null;T&&(T.get||T.set)?Object.defineProperty(N,S,T):N[S]=E[S]}return N.default=E,_&&_.set(E,N),N}(_(15649));function e(E){if("function"!=typeof WeakMap)return null;var A=new WeakMap,_=new WeakMap;return(e=function(E){return E?_:A})(E)}Object.keys(S).forEach(function(E){!("default"===E||"__esModule"===E||Object.prototype.hasOwnProperty.call(N,E))&&(E in A&&A[E]===S[E]||Object.defineProperty(A,E,{enumerable:!0,get:function(){return S[E]}}))})},79182:(E,A,_)=>{E.exports=_(30517)}};