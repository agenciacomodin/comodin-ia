"use strict";exports.id=5063,exports.ids=[5063],exports.modules={11826:(E,A,I)=>{I.d(A,{L:()=>C});var _=I(66291),N=I(64617),S=I(83178),T=I(3390),e=I.n(T),O=I(25590);let C={adapter:(0,N.N)(S._),session:{strategy:"jwt"},providers:[(0,_.Z)({id:"credentials",name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(E){if(!E?.email||!E?.password)throw Error("Credenciales incompletas");let A=await S._.user.findUnique({where:{email:E.email},include:{organization:!0}});if(!A)throw Error("Usuario no encontrado");if(!A.isActive)throw Error("Usuario inactivo");if("SUSPENDED"===A.organization.status||"INACTIVE"===A.organization.status)throw Error("Organizaci\xf3n suspendida o inactiva");let I=await S._.account.findFirst({where:{userId:A.id,provider:"credentials"}});if(!I?.refresh_token)throw Error("M\xe9todo de autenticaci\xf3n no v\xe1lido");if(!await e().compare(E.password,I.refresh_token))throw Error("Contrase\xf1a incorrecta");return await S._.user.update({where:{id:A.id},data:{lastLogin:new Date}}),{id:A.id,email:A.email,name:A.name,image:A.image,organizationId:A.organizationId,role:A.role,fullName:A.fullName,phone:A.phone,country:A.country,permissions:(0,O.ai)(A.role).map(E=>E.toString())}}})],callbacks:{jwt:async({token:E,user:A})=>(A&&(E.organizationId=A.organizationId,E.role=A.role,E.fullName=A.fullName,E.phone=A.phone,E.country=A.country,E.permissions=A.permissions),E),session:async({session:E,token:A})=>(A&&E.user&&(E.user.id=A.sub,E.user.organizationId=A.organizationId,E.user.role=A.role,E.user.fullName=A.fullName,E.user.phone=A.phone,E.user.country=A.country,E.user.permissions=A.permissions),E),redirect:async({url:E,baseUrl:A})=>E===A||E.startsWith(A+"/auth")?A+"/dashboard":E},pages:{signIn:"/auth/login"},events:{async signIn({user:E,account:A,profile:I,isNewUser:_}){console.log(`âœ… Usuario iniciado sesi\xf3n: ${E.email}`)}}}},83178:(E,A,I)=>{I.d(A,{_:()=>N,db:()=>S});var _=I(53524);let N=globalThis.prisma??new _.PrismaClient,S=N},79591:(E,A,I)=>{var _;function N(E,A){switch(E.role){case"SUPER_ADMIN":case"DISTRIBUIDOR":return!0;case"PROPIETARIO":case"AGENTE":return E.organizationId===A;default:return!1}}function S(E){switch(function(E){switch(E){case"SUPER_ADMIN":return"PLATFORM";case"DISTRIBUIDOR":return"MULTI_TENANT";case"PROPIETARIO":return"ORGANIZATION";default:return"LIMITED"}}(E.role)){case"PLATFORM":return{organizationIds:"ALL",includeSubordinates:!0};case"MULTI_TENANT":return{organizationIds:"SUPER_ADMIN"===E.role?"ALL":[E.organizationId],includeSubordinates:!0};case"ORGANIZATION":return{organizationIds:[E.organizationId],includeSubordinates:!0};default:return{organizationIds:[E.organizationId],userIds:[E.id],includeSubordinates:!1}}}I.d(A,{p_:()=>S,rB:()=>N}),I(25590),!function(E){E.PLATFORM="PLATFORM",E.MULTI_TENANT="MULTI_TENANT",E.ORGANIZATION="ORGANIZATION",E.LIMITED="LIMITED"}(_||(_={}))},25590:(E,A,I)=>{var _;I.d(A,{Fs:()=>S,ai:()=>T,y3:()=>_}),function(E){E.MANAGE_ORGANIZATION="MANAGE_ORGANIZATION",E.VIEW_ORGANIZATION_SETTINGS="VIEW_ORGANIZATION_SETTINGS",E.MANAGE_USERS="MANAGE_USERS",E.INVITE_USERS="INVITE_USERS",E.VIEW_ALL_USERS="VIEW_ALL_USERS",E.VIEW_ALL_CONVERSATIONS="VIEW_ALL_CONVERSATIONS",E.VIEW_ASSIGNED_CONVERSATIONS="VIEW_ASSIGNED_CONVERSATIONS",E.MANAGE_CONVERSATIONS="MANAGE_CONVERSATIONS",E.ASSIGN_CONVERSATIONS="ASSIGN_CONVERSATIONS",E.MANAGE_WHATSAPP_CONFIG="MANAGE_WHATSAPP_CONFIG",E.VIEW_WHATSAPP_SETTINGS="VIEW_WHATSAPP_SETTINGS",E.MANAGE_BILLING="MANAGE_BILLING",E.VIEW_BILLING="VIEW_BILLING",E.CONFIGURE_AI="CONFIGURE_AI",E.USE_AI_FEATURES="USE_AI_FEATURES",E.VIEW_AI_USAGE="VIEW_AI_USAGE",E.USE_AI_BROKER="USE_AI_BROKER",E.VIEW_AI_BROKER_STATS="VIEW_AI_BROKER_STATS",E.VIEW_REPORTS="VIEW_REPORTS",E.VIEW_ADVANCED_ANALYTICS="VIEW_ADVANCED_ANALYTICS",E.VIEW_CONTACTS="VIEW_CONTACTS",E.MANAGE_CONTACTS="MANAGE_CONTACTS",E.CREATE_CONTACTS="CREATE_CONTACTS",E.DELETE_CONTACTS="DELETE_CONTACTS",E.VIEW_CRM_INBOX="VIEW_CRM_INBOX",E.MANAGE_CRM_CONVERSATIONS="MANAGE_CRM_CONVERSATIONS",E.SEND_MESSAGES="SEND_MESSAGES",E.VIEW_ALL_CRM_CONVERSATIONS="VIEW_ALL_CRM_CONVERSATIONS",E.ASSIGN_CRM_CONVERSATIONS="ASSIGN_CRM_CONVERSATIONS",E.MANAGE_CONTACT_TAGS="MANAGE_CONTACT_TAGS",E.VIEW_CONTACT_NOTES="VIEW_CONTACT_NOTES",E.MANAGE_CONTACT_NOTES="MANAGE_CONTACT_NOTES",E.TRANSFER_CONVERSATIONS="TRANSFER_CONVERSATIONS",E.MANAGE_WHATSAPP_CHANNELS="MANAGE_WHATSAPP_CHANNELS",E.VIEW_WHATSAPP_CHANNELS="VIEW_WHATSAPP_CHANNELS",E.CREATE_WHATSAPP_CHANNELS="CREATE_WHATSAPP_CHANNELS",E.DELETE_WHATSAPP_CHANNELS="DELETE_WHATSAPP_CHANNELS",E.CONFIGURE_QR_CONNECTION="CONFIGURE_QR_CONNECTION",E.CONFIGURE_API_CONNECTION="CONFIGURE_API_CONNECTION",E.MANAGE_QUICK_REPLIES="MANAGE_QUICK_REPLIES",E.VIEW_QUICK_REPLIES="VIEW_QUICK_REPLIES",E.CREATE_QUICK_REPLIES="CREATE_QUICK_REPLIES",E.DELETE_QUICK_REPLIES="DELETE_QUICK_REPLIES",E.USE_QUICK_REPLIES="USE_QUICK_REPLIES",E.VIEW_ALL_QUICK_REPLIES="VIEW_ALL_QUICK_REPLIES",E.MANAGE_KNOWLEDGE_BASE="MANAGE_KNOWLEDGE_BASE",E.VIEW_KNOWLEDGE_BASE="VIEW_KNOWLEDGE_BASE",E.MANAGE_ORGANIZATION_SETTINGS="MANAGE_ORGANIZATION_SETTINGS",E.MANAGE_CLIENT_ORGANIZATIONS="MANAGE_CLIENT_ORGANIZATIONS",E.VIEW_COMMISSIONS="VIEW_COMMISSIONS",E.CREATE_CLIENT_ACCOUNTS="CREATE_CLIENT_ACCOUNTS",E.PLATFORM_ADMINISTRATION="PLATFORM_ADMINISTRATION",E.VIEW_ALL_ORGANIZATIONS="VIEW_ALL_ORGANIZATIONS",E.MANAGE_SYSTEM_SETTINGS="MANAGE_SYSTEM_SETTINGS",E.MANAGE_AI_PROVIDERS="MANAGE_AI_PROVIDERS",E.VIEW_INTEGRATIONS="VIEW_INTEGRATIONS",E.MANAGE_INTEGRATIONS="MANAGE_INTEGRATIONS",E.CONNECT_INTEGRATIONS="CONNECT_INTEGRATIONS",E.DISCONNECT_INTEGRATIONS="DISCONNECT_INTEGRATIONS",E.VIEW_INTEGRATION_LOGS="VIEW_INTEGRATION_LOGS",E.CONFIGURE_INTEGRATION_SETTINGS="CONFIGURE_INTEGRATION_SETTINGS",E.VIEW_CAMPAIGNS="VIEW_CAMPAIGNS",E.MANAGE_CAMPAIGNS="MANAGE_CAMPAIGNS",E.CREATE_CAMPAIGNS="CREATE_CAMPAIGNS",E.DELETE_CAMPAIGNS="DELETE_CAMPAIGNS",E.EXECUTE_CAMPAIGNS="EXECUTE_CAMPAIGNS",E.PAUSE_CAMPAIGNS="PAUSE_CAMPAIGNS",E.VIEW_CAMPAIGN_ANALYTICS="VIEW_CAMPAIGN_ANALYTICS",E.VIEW_MESSAGE_TEMPLATES="VIEW_MESSAGE_TEMPLATES",E.MANAGE_MESSAGE_TEMPLATES="MANAGE_MESSAGE_TEMPLATES",E.CREATE_MESSAGE_TEMPLATES="CREATE_MESSAGE_TEMPLATES",E.DELETE_MESSAGE_TEMPLATES="DELETE_MESSAGE_TEMPLATES",E.SYNC_META_TEMPLATES="SYNC_META_TEMPLATES",E.USE_AUDIENCE_BUILDER="USE_AUDIENCE_BUILDER",E.VIEW_AUDIENCE_PREVIEW="VIEW_AUDIENCE_PREVIEW",E.MANAGE_AUDIENCE_FILTERS="MANAGE_AUDIENCE_FILTERS",E.VIEW_SENDING_QUEUE="VIEW_SENDING_QUEUE",E.MANAGE_SENDING_SETTINGS="MANAGE_SENDING_SETTINGS"}(_||(_={}));let N={SUPER_ADMIN:[...Object.values(_)],DISTRIBUIDOR:["MANAGE_CLIENT_ORGANIZATIONS","VIEW_COMMISSIONS","CREATE_CLIENT_ACCOUNTS","VIEW_ORGANIZATION_SETTINGS","VIEW_BILLING","VIEW_REPORTS","USE_AI_FEATURES","VIEW_AI_USAGE","USE_AI_BROKER","VIEW_ALL_CONVERSATIONS","MANAGE_CONVERSATIONS"],PROPIETARIO:["MANAGE_ORGANIZATION","VIEW_ORGANIZATION_SETTINGS","MANAGE_ORGANIZATION_SETTINGS","MANAGE_USERS","INVITE_USERS","VIEW_ALL_USERS","VIEW_ALL_CONVERSATIONS","MANAGE_CONVERSATIONS","ASSIGN_CONVERSATIONS","MANAGE_WHATSAPP_CONFIG","VIEW_WHATSAPP_SETTINGS","MANAGE_BILLING","VIEW_BILLING","CONFIGURE_AI","USE_AI_FEATURES","VIEW_AI_USAGE","USE_AI_BROKER","VIEW_AI_BROKER_STATS","VIEW_REPORTS","VIEW_ADVANCED_ANALYTICS","MANAGE_CAMPAIGNS","VIEW_CAMPAIGNS","VIEW_CONTACTS","MANAGE_CONTACTS","CREATE_CONTACTS","DELETE_CONTACTS","VIEW_CRM_INBOX","MANAGE_CRM_CONVERSATIONS","SEND_MESSAGES","VIEW_ALL_CRM_CONVERSATIONS","ASSIGN_CRM_CONVERSATIONS","MANAGE_CONTACT_TAGS","VIEW_CONTACT_NOTES","MANAGE_CONTACT_NOTES","TRANSFER_CONVERSATIONS","MANAGE_WHATSAPP_CHANNELS","VIEW_WHATSAPP_CHANNELS","CREATE_WHATSAPP_CHANNELS","DELETE_WHATSAPP_CHANNELS","CONFIGURE_QR_CONNECTION","CONFIGURE_API_CONNECTION","MANAGE_QUICK_REPLIES","VIEW_QUICK_REPLIES","CREATE_QUICK_REPLIES","DELETE_QUICK_REPLIES","USE_QUICK_REPLIES","VIEW_ALL_QUICK_REPLIES","MANAGE_KNOWLEDGE_BASE","VIEW_KNOWLEDGE_BASE","VIEW_INTEGRATIONS","MANAGE_INTEGRATIONS","CONNECT_INTEGRATIONS","DISCONNECT_INTEGRATIONS","VIEW_INTEGRATION_LOGS","CONFIGURE_INTEGRATION_SETTINGS","VIEW_CAMPAIGNS","MANAGE_CAMPAIGNS","CREATE_CAMPAIGNS","DELETE_CAMPAIGNS","EXECUTE_CAMPAIGNS","PAUSE_CAMPAIGNS","VIEW_CAMPAIGN_ANALYTICS","VIEW_MESSAGE_TEMPLATES","MANAGE_MESSAGE_TEMPLATES","CREATE_MESSAGE_TEMPLATES","DELETE_MESSAGE_TEMPLATES","SYNC_META_TEMPLATES","USE_AUDIENCE_BUILDER","VIEW_AUDIENCE_PREVIEW","MANAGE_AUDIENCE_FILTERS","VIEW_SENDING_QUEUE","MANAGE_SENDING_SETTINGS"],AGENTE:["VIEW_ASSIGNED_CONVERSATIONS","USE_AI_FEATURES","USE_AI_BROKER","VIEW_WHATSAPP_SETTINGS","VIEW_CONTACTS","VIEW_KNOWLEDGE_BASE","VIEW_CAMPAIGNS","VIEW_CRM_INBOX","SEND_MESSAGES","VIEW_CONTACT_NOTES","MANAGE_CONTACT_NOTES","USE_QUICK_REPLIES","VIEW_QUICK_REPLIES","VIEW_CAMPAIGNS","VIEW_MESSAGE_TEMPLATES"]};function S(E,A){return N[E].includes(A)}function T(E){return N[E]}},23926:(E,A)=>{Object.defineProperty(A,"__esModule",{value:!0})},57978:(E,A,I)=>{Object.defineProperty(A,"__esModule",{value:!0});var _={};Object.defineProperty(A,"default",{enumerable:!0,get:function(){return S.default}});var N=I(23926);Object.keys(N).forEach(function(E){!("default"===E||"__esModule"===E||Object.prototype.hasOwnProperty.call(_,E))&&(E in A&&A[E]===N[E]||Object.defineProperty(A,E,{enumerable:!0,get:function(){return N[E]}}))});var S=function(E,A){if(E&&E.__esModule)return E;if(null===E||"object"!=typeof E&&"function"!=typeof E)return{default:E};var I=T(void 0);if(I&&I.has(E))return I.get(E);var _={__proto__:null},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var S in E)if("default"!==S&&({}).hasOwnProperty.call(E,S)){var e=N?Object.getOwnPropertyDescriptor(E,S):null;e&&(e.get||e.set)?Object.defineProperty(_,S,e):_[S]=E[S]}return _.default=E,I&&I.set(E,_),_}(I(15649));function T(E){if("function"!=typeof WeakMap)return null;var A=new WeakMap,I=new WeakMap;return(T=function(E){return E?I:A})(E)}Object.keys(S).forEach(function(E){!("default"===E||"__esModule"===E||Object.prototype.hasOwnProperty.call(_,E))&&(E in A&&A[E]===S[E]||Object.defineProperty(A,E,{enumerable:!0,get:function(){return S[E]}}))})}};