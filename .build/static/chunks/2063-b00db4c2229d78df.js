(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2063],{42063:function(e,s,a){Promise.resolve().then(a.bind(a,82538)),Promise.resolve().then(a.bind(a,60026))},82538:function(e,s,a){"use strict";a.d(s,{ProtectedRoute:function(){return o}});var r=a(15444),n=a(51924),t=a(56948),i=a(81059),l=a(70362),c=a(2422),d=a(79047);function o({children:e,permissions:s=[],requireAll:a=!1,fallback:o,redirectTo:m}){let{isLoading:u,isAuthenticated:x,hasAnyPermission:f,hasAllPermissions:h,getDashboardRoute:j}=(0,n.TE)(),g=(0,d.useRouter)();return u?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):x?!(s.length>0)||(a?h(s):f(s))?(0,r.jsx)(r.Fragment,{children:e}):o?(0,r.jsx)(r.Fragment,{children:o}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,r.jsxs)(t.bZ,{className:"max-w-md",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),(0,r.jsx)(t.Cd,{children:"Sin Permisos"}),(0,r.jsx)(t.X,{children:"No tienes los permisos necesarios para acceder a esta funcionalidad."}),(0,r.jsx)(c.z,{onClick:()=>g.push(m||j()),className:"mt-3 w-full",children:"Volver al Dashboard"})]})}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,r.jsxs)(t.bZ,{className:"max-w-md",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),(0,r.jsx)(t.Cd,{children:"Acceso Denegado"}),(0,r.jsx)(t.X,{children:"Debes iniciar sesi\xf3n para acceder a esta p\xe1gina."}),(0,r.jsx)(c.z,{onClick:()=>g.push("/auth/login"),className:"mt-3 w-full",children:"Iniciar Sesi\xf3n"})]})})}},60026:function(e,s,a){"use strict";a.d(s,{AIResolutionTester:function(){return b}});var r=a(15444),n=a(89300),t=a(2422),i=a(67012),l=a(99827),c=a(61335),d=a(37108),o=a(86765),m=a(4464),u=a(61572),x=a(25076),f=a(18218),h=a(26771),j=a(26584),g=a(62492),p=a(66124),N=a(66772),v=a(64611);function b(){var e,s;let[a,b]=(0,n.useState)(""),[y,w]=(0,n.useState)(!1),[R,A]=(0,n.useState)(null),[C,P]=(0,n.useState)(null),T=async()=>{if(!a.trim()){v.Am.error("Por favor ingresa una consulta para probar");return}w(!0);try{let e=await fetch("/api/crm/ai-resolution/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a.trim(),options:{responseStyle:"professional"}})});if(!e.ok)throw Error("Error en la prueba");let s=await e.json();A(s.data),v.Am.success("Prueba completada")}catch(e){console.error("Error:",e),v.Am.error("Error al probar la resoluci\xf3n")}finally{w(!1)}},E=async()=>{try{let e=await fetch("/api/crm/ai-resolution/test");if(e.ok){let s=await e.json();P(s.data)}}catch(e){console.error("Error cargando estad\xedsticas:",e)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Probador de IA Resolutiva"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Prueba c\xf3mo la IA responde a consultas de clientes usando el entrenamiento de IA"})]}),(0,r.jsxs)(t.z,{onClick:E,variant:"outline",size:"sm",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Ver Estad\xedsticas"]})]}),(0,r.jsxs)(o.Tabs,{defaultValue:"tester",className:"space-y-4",children:[(0,r.jsxs)(o.TabsList,{children:[(0,r.jsxs)(o.TabsTrigger,{value:"tester",className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4"}),"Probador"]}),C&&(0,r.jsxs)(o.TabsTrigger,{value:"stats",className:"flex items-center gap-2",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4"}),"Estad\xedsticas"]})]}),(0,r.jsxs)(o.TabsContent,{value:"tester",className:"space-y-6",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{children:[(0,r.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(x.Z,{className:"h-5 w-5"}),"Consulta de Prueba"]}),(0,r.jsx)(l.SZ,{children:"Simula una pregunta de cliente para ver c\xf3mo responde la IA"})]}),(0,r.jsxs)(l.aY,{className:"space-y-4",children:[(0,r.jsx)(i.g,{placeholder:"Ejemplo: \xbfCu\xe1les son sus horarios de atenci\xf3n? o \xbfTienen cat\xe1logo de productos?",value:a,onChange:e=>b(e.target.value),rows:3,className:"w-full"}),(0,r.jsx)(t.z,{onClick:T,disabled:y||!a.trim(),className:"w-full",children:y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{className:"h-4 w-4 mr-2 animate-pulse"}),"Procesando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Probar Resoluci\xf3n"]})})]})]}),R&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(m.Z,{className:"h-5 w-5"}),"Resumen de Resultados"]})}),(0,r.jsxs)(l.aY,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:`w-3 h-3 rounded-full ${(e=R.summary.confidence)>=.8?"bg-green-500":e>=.6?"bg-yellow-500":"bg-red-500"}`}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Confianza"})]}),(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[Math.round(100*R.summary.confidence),"%"]}),(0,r.jsx)(c.C,{variant:"outline",className:"text-xs",children:(s=R.summary.confidence)>=.8?"Alta":s>=.6?"Media":"Baja"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 text-blue-500"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Fuentes"})]}),(0,r.jsx)("div",{className:"text-2xl font-bold",children:R.summary.knowledgeSourcesFound}),(0,r.jsx)(c.C,{variant:"outline",className:"text-xs",children:"Encontradas"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"h-4 w-4 text-green-500"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Archivos"})]}),(0,r.jsx)("div",{className:"text-2xl font-bold",children:R.summary.filesWouldBeSent}),(0,r.jsx)(c.C,{variant:"outline",className:"text-xs",children:"Se enviar\xedan"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 text-purple-500"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Tiempo"})]}),(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[R.summary.processingTimeMs,"ms"]}),(0,r.jsx)(c.C,{variant:"outline",className:"text-xs",children:"Procesamiento"})]})]}),(0,r.jsx)("div",{className:"mt-4 p-3 rounded-lg bg-gray-50",children:(0,r.jsx)("div",{className:"flex items-center gap-2",children:R.summary.wouldAutoRespond?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{className:"h-5 w-5 text-green-500"}),(0,r.jsx)("span",{className:"font-medium text-green-700",children:"La IA responder\xeda autom\xe1ticamente"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.Z,{className:"h-5 w-5 text-yellow-500"}),(0,r.jsx)("span",{className:"font-medium text-yellow-700",children:"La IA no responder\xeda autom\xe1ticamente (confianza insuficiente)"})]})})})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Respuesta Generada"})}),(0,r.jsx)(l.aY,{children:(0,r.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg",children:(0,r.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap",children:R.resolution.responseText})})})]}),R.resolution.filesToSend.length>0&&(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"h-5 w-5"}),"Archivos que se Enviar\xedan Autom\xe1ticamente"]})}),(0,r.jsx)(l.aY,{children:(0,r.jsx)("div",{className:"space-y-3",children:R.resolution.filesToSend.map((e,s)=>(0,r.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 text-blue-500"}),(0,r.jsx)("span",{className:"font-medium",children:e.fileName})]}),(0,r.jsx)(c.C,{variant:"outline",children:e.sourceName})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.reason})]},s))})})]}),R.resolution.knowledgeUsed.length>0&&(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"h-5 w-5"}),"Fuentes de Conocimiento Utilizadas"]})}),(0,r.jsx)(l.aY,{children:(0,r.jsx)("div",{className:"space-y-3",children:R.resolution.knowledgeUsed.map((e,s)=>(0,r.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"font-medium",children:e.sourceName}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.E,{value:100*e.similarity,className:"w-20 h-2"}),(0,r.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[Math.round(100*e.similarity),"%"]})]})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[e.content.substring(0,200),"..."]})]},s))})})]})]})]}),(0,r.jsx)(o.TabsContent,{value:"stats",children:C&&(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{children:["Estad\xedsticas de Resoluci\xf3n (",C.period,")"]})}),(0,r.jsxs)(l.aY,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:"Total Resoluciones"}),(0,r.jsx)("div",{className:"text-2xl font-bold",children:C.statistics.totalResolutions})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:"Confianza Promedio"}),(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[Math.round(100*C.statistics.avgConfidence),"%"]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:"Tiempo Promedio"}),(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[Math.round(C.statistics.avgProcessingTime),"ms"]})]})]}),C.recentQueries.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium mb-3",children:"Consultas Recientes"}),(0,r.jsx)("div",{className:"space-y-2",children:C.recentQueries.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,r.jsx)("span",{className:"text-sm",children:e.query}),(0,r.jsxs)(c.C,{variant:"outline",children:[Math.round(100*e.confidence),"%"]})]},s))})]})]})]})})]})]})}},56948:function(e,s,a){"use strict";a.d(s,{Cd:function(){return d},X:function(){return o},bZ:function(){return c}});var r=a(15444),n=a(89300),t=a(2371),i=a(65522);let l=(0,t.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),c=n.forwardRef(({className:e,variant:s,...a},n)=>(0,r.jsx)("div",{ref:n,role:"alert",className:(0,i.cn)(l({variant:s}),e),...a}));c.displayName="Alert";let d=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("h5",{ref:a,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",e),...s}));d.displayName="AlertTitle";let o=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("div",{ref:a,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",e),...s}));o.displayName="AlertDescription"},61335:function(e,s,a){"use strict";a.d(s,{C:function(){return l}});var r=a(15444);a(89300);var n=a(2371),t=a(65522);let i=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:s,...a}){return(0,r.jsx)("div",{className:(0,t.cn)(i({variant:s}),e),...a})}},99827:function(e,s,a){"use strict";a.d(s,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return i},aY:function(){return o},eW:function(){return m},ll:function(){return c}});var r=a(15444),n=a(89300),t=a(65522);let i=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("div",{ref:a,className:(0,t.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));i.displayName="Card";let l=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("div",{ref:a,className:(0,t.cn)("flex flex-col space-y-1.5 p-6",e),...s}));l.displayName="CardHeader";let c=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("h3",{ref:a,className:(0,t.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));c.displayName="CardTitle";let d=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("p",{ref:a,className:(0,t.cn)("text-sm text-muted-foreground",e),...s}));d.displayName="CardDescription";let o=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("div",{ref:a,className:(0,t.cn)("p-6 pt-0",e),...s}));o.displayName="CardContent";let m=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("div",{ref:a,className:(0,t.cn)("flex items-center p-6 pt-0",e),...s}));m.displayName="CardFooter"},37108:function(e,s,a){"use strict";a.d(s,{E:function(){return l}});var r=a(15444),n=a(89300),t=a(25052),i=a(65522);let l=n.forwardRef(({className:e,value:s,...a},n)=>(0,r.jsx)(t.fC,{ref:n,className:(0,i.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...a,children:(0,r.jsx)(t.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));l.displayName=t.fC.displayName},86765:function(e,s,a){"use strict";a.d(s,{Tabs:function(){return l},TabsContent:function(){return o},TabsList:function(){return c},TabsTrigger:function(){return d}});var r=a(15444),n=a(89300),t=a(84018),i=a(65522);let l=t.fC,c=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)(t.aV,{ref:a,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));c.displayName=t.aV.displayName;let d=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)(t.xz,{ref:a,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));d.displayName=t.xz.displayName;let o=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)(t.VY,{ref:a,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));o.displayName=t.VY.displayName},67012:function(e,s,a){"use strict";a.d(s,{g:function(){return i}});var r=a(15444),n=a(89300),t=a(65522);let i=n.forwardRef(({className:e,...s},a)=>(0,r.jsx)("textarea",{className:(0,t.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...s}));i.displayName="Textarea"},51924:function(e,s,a){"use strict";a.d(s,{TE:function(){return t}});var r=a(75762),n=a(92937);function t(){let{data:e,status:s}=(0,r.useSession)(),a=e?.user,t=a?.role,i=a?.organizationId;return{isAuthenticated:!!e,isLoading:"loading"===s,user:a,role:t,organizationId:i,hasPermission:e=>!!t&&(0,n.N$)(t,e),hasAnyPermission:e=>!!t&&(0,n.vr)(t,e),hasAllPermissions:e=>{if(!t)return!1;let s=(0,n.ai)(t).map(e=>e.toString());return(0,n.wP)(s,e)},canAccessRoute:e=>{if(!t)return!1;let s=(0,n.ai)(t).map(e=>e.toString());return(0,n.mn)(s,e)},getDashboardRoute:()=>t?(0,n.Ol)(t):"/dashboard",getAllPermissions:()=>t?(0,n.ai)(t):[],isSuperAdmin:"SUPER_ADMIN"===t,isDistributor:"DISTRIBUIDOR"===t,isOwner:"PROPIETARIO"===t,isAgent:"AGENTE"===t,canManageUsers:"SUPER_ADMIN"===t||"PROPIETARIO"===t,canManageOrganization:"SUPER_ADMIN"===t||"PROPIETARIO"===t,canViewAllConversations:"AGENTE"!==t,canManageWhatsApp:"SUPER_ADMIN"===t||"PROPIETARIO"===t,canManageBilling:"SUPER_ADMIN"===t||"PROPIETARIO"===t,canConfigureAI:"SUPER_ADMIN"===t||"PROPIETARIO"===t,canViewReports:"AGENTE"!==t,canManageClients:"DISTRIBUIDOR"===t||"SUPER_ADMIN"===t}}}}]);