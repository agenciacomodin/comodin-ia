(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8988],{5988:function(e,s,a){Promise.resolve().then(a.bind(a,2665))},2665:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return eo}});var t=a(15444),n=a(89300),r=a(75762),i=a(82538),l=a(92937),c=a(98699),d=a(25076),o=a(90185),m=a(58510),x=a(74678),u=a(2422),h=a(61335),p=a(81577),j=a(99719),g=a(65522),f=a(33186);function N({conversations:e,selectedConversationId:s,onSelectConversation:a,searchTerm:n,onSearchChange:r,statusFilter:i,onStatusFilterChange:l}){let N=e=>{if(!e)return"";let s=new Date,a=new Date(e),t=s.getTime()-a.getTime(),n=Math.floor(t/6e4),r=Math.floor(t/36e5),i=Math.floor(t/864e5);return n<1?"Ahora":n<60?`${n}m`:r<24?`${r}h`:i<7?`${i}d`:a.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit"})},v=e=>e.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2),y=e=>{switch(f.WC[e]){case"red":return"bg-red-500";case"orange":return"bg-orange-500";case"blue":return"bg-blue-500";default:return"bg-gray-400"}},b=e.filter(e=>{let s=e.contact.name.toLowerCase().includes(n.toLowerCase())||e.contact.phone.includes(n)||(e.lastMessageText||"").toLowerCase().includes(n.toLowerCase()),a="ALL"===i||e.status===i;return s&&a});return(0,t.jsxs)("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Chats"}),(0,t.jsxs)(j.h_,{children:[(0,t.jsx)(j.$F,{asChild:!0,children:(0,t.jsx)(u.z,{variant:"ghost",size:"sm",children:(0,t.jsx)(c.Z,{className:"h-4 w-4"})})}),(0,t.jsxs)(j.AW,{align:"end",children:[(0,t.jsx)(j.Ju,{children:"Filtrar por estado"}),(0,t.jsx)(j.VD,{}),(0,t.jsx)(j.Xi,{onClick:()=>l("ALL"),children:"Todos"}),(0,t.jsx)(j.Xi,{onClick:()=>l("OPEN"),children:f.WY.OPEN}),(0,t.jsx)(j.Xi,{onClick:()=>l("PENDING"),children:f.WY.PENDING}),(0,t.jsx)(j.Xi,{onClick:()=>l("RESOLVED"),children:f.WY.RESOLVED})]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(d.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)(x.I,{type:"text",placeholder:"Buscar chats...",value:n,onChange:e=>r(e.target.value),className:"pl-10"})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===b.length?(0,t.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,t.jsx)(o.Z,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),(0,t.jsx)("p",{className:"text-sm",children:"No hay conversaciones"})]}):(0,t.jsx)("div",{className:"space-y-1",children:b.map(e=>(0,t.jsx)("div",{onClick:()=>a(e.id),className:(0,g.cn)("p-3 hover:bg-gray-50 cursor-pointer transition-colors border-l-4 border-transparent",s===e.id&&"bg-blue-50 border-l-blue-500"),children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)(p.Avatar,{className:"h-12 w-12",children:[(0,t.jsx)(p.AvatarImage,{src:e.contact.avatar}),(0,t.jsx)(p.AvatarFallback,{className:"bg-gray-100 text-gray-600",children:v(e.contact.name)})]}),e.contact.isVip&&(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-xs text-white font-bold",children:"★"})})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:e.contact.name}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:["MEDIUM"!==e.priority&&(0,t.jsx)("div",{className:(0,g.cn)("w-2 h-2 rounded-full",y(e.priority))}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:N(e.lastMessageAt)})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600 truncate flex-1",children:["OUTGOING"===e.lastMessageFrom&&(0,t.jsx)("span",{className:"text-gray-400 mr-1",children:"→"}),e.lastMessageText||"Sin mensajes"]}),e.unreadCount>0&&(0,t.jsx)(h.C,{variant:"destructive",className:"ml-2 text-xs",children:e.unreadCount>99?"99+":e.unreadCount})]}),(0,t.jsxs)("div",{className:"flex items-center mt-1",children:[(0,t.jsx)(m.Z,{className:"h-3 w-3 text-gray-400 mr-1"}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.contact.phone})]})]})]})},e.id))})})]})}var v=a(62814),y=a(78539),b=a(67012),w=a(99827),C=a(37108),A=a(60572),D=a(82061),I=a(26771),E=a(33485),S=a(34761),k=a(62492),R=a(9573),M=a(19827),Z=a(81178),z=a(64611);let T=[{id:"qr1",title:"Saludo Inicial",shortcut:"hola",content:"\xa1Hola! Gracias por contactarnos. \xbfEn qu\xe9 podemos ayudarte hoy?",category:"Saludos",tags:["saludo","bienvenida"],usageCount:156,lastUsedAt:new Date,createdAt:new Date,createdByName:"Ana Mart\xednez"},{id:"qr2",title:"Informaci\xf3n de Precios",shortcut:"precios",content:"Te env\xedo nuestra lista de precios actualizada. Si tienes alguna duda espec\xedfica, no dudes en consultarme.",category:"Ventas",tags:["precios","ventas","productos"],usageCount:89,lastUsedAt:new Date,createdAt:new Date,createdByName:"Carlos Rivera"},{id:"qr3",title:"Horarios de Atenci\xf3n",shortcut:"horarios",content:"Nuestros horarios de atenci\xf3n son:\n\n\uD83D\uDCC5 Lunes a Viernes: 9:00 AM - 6:00 PM\n\uD83D\uDCC5 S\xe1bados: 9:00 AM - 2:00 PM\n\uD83D\uDCC5 Domingos: Cerrado",category:"Informaci\xf3n",tags:["horarios","atencion","disponibilidad"],usageCount:124,lastUsedAt:new Date,createdAt:new Date,createdByName:"Mar\xeda Gonz\xe1lez"},{id:"qr4",title:"Agradecimiento",shortcut:"gracias",content:"\xa1Gracias por contactarnos! Ha sido un placer atenderte. Si tienes alguna otra consulta, estaremos aqu\xed para ayudarte.",category:"Despedida",tags:["gracias","despedida","cierre"],usageCount:203,lastUsedAt:new Date,createdAt:new Date,createdByName:"Luis Herrera"},{id:"qr5",title:"Soporte T\xe9cnico",shortcut:"soporte",content:"Para brindarte el mejor soporte t\xe9cnico, necesito algunos datos adicionales:\n\n• Modelo del producto\n• Descripci\xf3n del problema\n• Fotos si es necesario",category:"Soporte",tags:["soporte","tecnico","ayuda"],usageCount:67,lastUsedAt:new Date,createdAt:new Date,createdByName:"Diego Morales"}];function O({conversationId:e,onSendMessage:s,disabled:a=!1,placeholder:i="Escribe tu mensaje..."}){let{data:l}=(0,r.useSession)()||{},[c,d]=(0,n.useState)({content:"",files:[],showQuickReplies:!1,quickReplySearch:""}),[o,m]=(0,n.useState)({isRecording:!1,isPaused:!1,duration:0}),x=(0,n.useRef)(null),p=(0,n.useRef)(null),j=(0,n.useRef)(null),g=(0,n.useRef)([]),N=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=x.current;e&&(e.style.height="auto",e.style.height=`${Math.min(e.scrollHeight,120)}px`)},[c.content]),(0,n.useEffect)(()=>()=>{N.current&&clearInterval(N.current),j.current&&j.current.stop()},[]);let y=e=>f.aE.image.includes(e.type)?"image":f.aE.video.includes(e.type)?"video":f.aE.audio.includes(e.type)?"audio":"document",O=e=>{let s=y(e),a=f.n9[s];return e.size>a?`El archivo es muy grande. M\xe1ximo ${Math.round(a/1048576)}MB para ${s}`:null},P=e=>{let s=0,a=setInterval(()=>{(s+=20*Math.random())>=100&&(s=100,clearInterval(a)),d(a=>({...a,files:a.files.map(a=>a.id===e?{...a,uploadProgress:s}:a)}))},200)},G=e=>{d(s=>({...s,files:s.files.filter(s=>s.id!==e)}))},B=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(e);j.current=s,g.current=[],s.ondataavailable=e=>{e.data.size>0&&g.current.push(e.data)},s.onstop=()=>{let s=new Blob(g.current,{type:"audio/wav"}),a=URL.createObjectURL(s);m(e=>({...e,audioBlob:s,audioUrl:a,isRecording:!1})),e.getTracks().forEach(e=>e.stop())},s.start(),m(e=>({...e,isRecording:!0,duration:0})),N.current=setInterval(()=>{m(e=>({...e,duration:e.duration+1}))},1e3)}catch(e){z.Am.error("No se pudo acceder al micr\xf3fono"),console.error("Error al acceder al micr\xf3fono:",e)}},q=()=>{j.current&&"inactive"!==j.current.state&&j.current.stop(),N.current&&(clearInterval(N.current),N.current=null)},U=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,V=e=>{d(s=>{let a={...s,content:e};if(e.endsWith("/"))return{...a,showQuickReplies:!0,quickReplySearch:""};if(s.showQuickReplies){let s=e.lastIndexOf("/");if(-1!==s){let t=e.substring(s+1);return{...a,quickReplySearch:t}}}return a})},L=T.filter(e=>{if(!c.quickReplySearch)return!0;let s=c.quickReplySearch.toLowerCase();return e.shortcut.toLowerCase().includes(s)||e.title.toLowerCase().includes(s)||e.content.toLowerCase().includes(s)||e.tags.some(e=>e.toLowerCase().includes(s))}),$=e=>{let s=c.content.lastIndexOf("/"),a=(s>0?c.content.substring(0,s):"")+e.content;d(s=>({...s,content:a,showQuickReplies:!1,quickReplySearch:"",selectedQuickReply:e})),x.current?.focus()},F=()=>{if(a)return;let e=c.content.trim(),t=c.files.length>0,n=o.audioBlob;if(!e&&!t&&!n){x.current?.focus();return}let r="TEXT";if(n)r="AUDIO";else if(t){let e=c.files[0];r="image"===e.type?"IMAGE":"video"===e.type?"VIDEO":"DOCUMENT"}s({content:c.content.trim(),type:r,files:c.files.map(e=>e.file),audioBlob:o.audioBlob,quickReplyId:c.selectedQuickReply?.id}),d({content:"",files:[],showQuickReplies:!1,quickReplySearch:""}),m({isRecording:!1,isPaused:!1,duration:0}),x.current?.focus()},Y=e=>{switch(e){case"image":return(0,t.jsx)(A.Z,{className:"h-4 w-4"});case"video":return(0,t.jsx)(v.Z,{className:"h-4 w-4"});case"audio":return(0,t.jsx)(D.Z,{className:"h-4 w-4"});default:return(0,t.jsx)(I.Z,{className:"h-4 w-4"})}},X=c.content.trim()||c.files.length>0||o.audioBlob;return(0,t.jsxs)("div",{className:"border-t border-gray-200 bg-white",children:[c.files.length>0&&(0,t.jsx)("div",{className:"p-3 border-b border-gray-100",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:c.files.map(e=>(0,t.jsx)(w.Zb,{className:"relative w-20 h-20",children:(0,t.jsxs)(w.aY,{className:"p-2 h-full",children:[e.preview?(0,t.jsx)("img",{src:e.preview,alt:e.file.name,className:"w-full h-full object-cover rounded"}):(0,t.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gray-50 rounded",children:[Y(e.type),(0,t.jsx)("span",{className:"text-xs mt-1 text-center truncate w-full",children:e.file.name.split(".").pop()?.toUpperCase()})]}),void 0!==e.uploadProgress&&e.uploadProgress<100&&(0,t.jsx)("div",{className:"absolute bottom-1 left-1 right-1",children:(0,t.jsx)(C.E,{value:e.uploadProgress,className:"h-1"})}),(0,t.jsx)(u.z,{size:"sm",variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 p-0",onClick:()=>G(e.id),children:(0,t.jsx)(E.Z,{className:"h-3 w-3"})})]})},e.id))})}),o.audioBlob&&(0,t.jsx)("div",{className:"p-3 border-b border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3 bg-blue-50 p-3 rounded-lg",children:[(0,t.jsx)("div",{className:"p-2 bg-blue-100 rounded-full",children:(0,t.jsx)(D.Z,{className:"h-4 w-4 text-blue-600"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Audio grabado"}),(0,t.jsx)("p",{className:"text-xs text-blue-600",children:U(o.duration)})]}),o.audioUrl&&(0,t.jsx)("audio",{controls:!0,className:"w-32",children:(0,t.jsx)("source",{src:o.audioUrl,type:"audio/wav"})}),(0,t.jsx)(u.z,{size:"sm",variant:"outline",onClick:()=>{q(),m({isRecording:!1,isPaused:!1,duration:0})},children:(0,t.jsx)(E.Z,{className:"h-4 w-4"})})]})}),c.showQuickReplies&&(0,t.jsx)("div",{className:"p-3 border-b border-gray-100 max-h-60 overflow-y-auto",children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-2",children:[(0,t.jsx)(S.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Respuestas r\xe1pidas"}),c.quickReplySearch&&(0,t.jsxs)("span",{className:"text-blue-600",children:['"',c.quickReplySearch,'"']})]}),L.length>0?(0,t.jsx)("div",{className:"space-y-1",children:L.slice(0,5).map(e=>(0,t.jsx)("button",{onClick:()=>$(e),className:"w-full text-left p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("span",{className:"font-medium text-sm text-gray-900",children:["/",e.shortcut]}),(0,t.jsx)(h.C,{variant:"secondary",className:"text-xs",children:e.category})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1 truncate",children:e.content})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500 ml-2",children:[(0,t.jsx)(k.Z,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:e.usageCount})]})]})},e.id))}):(0,t.jsx)("p",{className:"text-sm text-gray-500 py-2",children:"No se encontraron respuestas r\xe1pidas"})]})}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(u.z,{variant:"ghost",size:"sm",className:"text-gray-500",onClick:()=>p.current?.click(),disabled:a,children:(0,t.jsx)(R.Z,{className:"h-5 w-5"})}),(0,t.jsx)("input",{ref:p,type:"file",multiple:!0,accept:Object.values(f.aE).flat().join(","),onChange:e=>{Array.from(e.target.files||[]).forEach(e=>{let s=O(e);if(s){z.Am.error(s);return}let a={id:`file_${Date.now()}_${Math.random()}`,file:e,type:y(e),uploadProgress:0};if("image"===a.type){let s=new FileReader;s.onload=e=>{d(s=>({...s,files:s.files.map(s=>s.id===a.id?{...s,preview:e.target?.result}:s)}))},s.readAsDataURL(e)}d(e=>({...e,files:[...e.files,a]})),P(a.id)}),e.target.value=""},className:"hidden"})]}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)(b.g,{ref:x,value:c.content,onChange:e=>V(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),F()),"Escape"===e.key&&c.showQuickReplies&&d(e=>({...e,showQuickReplies:!1}))},placeholder:o.isRecording?"Grabando audio...":i,disabled:a||o.isRecording,className:"resize-none min-h-[40px] max-h-[120px] border-0 focus-visible:ring-0 p-3",rows:1})}),(0,t.jsx)("div",{className:"relative",children:o.isRecording?(0,t.jsxs)("div",{className:"flex space-x-1",children:[(0,t.jsx)(u.z,{variant:"ghost",size:"sm",onClick:q,className:"text-red-600 hover:text-red-700",children:(0,t.jsx)(M.Z,{className:"h-5 w-5 fill-current"})}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 px-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),(0,t.jsx)("span",{className:"text-sm text-red-600 font-mono",children:U(o.duration)})]})]}):(0,t.jsx)(u.z,{variant:"ghost",size:"sm",className:"text-gray-500",onMouseDown:B,disabled:a,title:"Mant\xe9n presionado para grabar",children:(0,t.jsx)(D.Z,{className:"h-5 w-5"})})}),(0,t.jsx)(u.z,{onClick:F,disabled:a||!X,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:(0,t.jsx)(Z.Z,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("span",{children:"Escribe / para respuestas r\xe1pidas"}),c.selectedQuickReply&&(0,t.jsxs)(h.C,{variant:"outline",className:"text-xs",children:["Usaste: ",c.selectedQuickReply.shortcut]})]}),o.isRecording&&(0,t.jsx)("span",{className:"text-red-600",children:"Presiona el bot\xf3n cuadrado para detener"})]})]})]})}var P=a(29530),G=a(56948),B=a(61572),q=a(53492),U=a(66772),V=a(92690),L=a(4464),$=a(18218),F=a(4693);function Y({conversationId:e,contactName:s}){let[a,r]=(0,n.useState)(!1),[i,l]=(0,n.useState)(""),[c,d]=(0,n.useState)(!1),[o,m]=(0,n.useState)(null),[x,p]=(0,n.useState)(null),j=async()=>{if(!i.trim()){p("Por favor ingrese un mensaje para simular");return}d(!0),p(null),m(null);try{let s=await fetch("/api/crm/messages/simulate-incoming",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:e,content:i.trim()})}),a=await s.json();a.success?(m(a.data),l("")):p(a.error||"Error simulando mensaje")}catch(e){console.error("Error simulando mensaje:",e),p("Error de conexi\xf3n")}finally{d(!1)}},g=e=>{l(e),m(null),p(null)};return(0,t.jsxs)(P.Vq,{open:a,onOpenChange:r,children:[(0,t.jsx)(P.hg,{asChild:!0,children:(0,t.jsxs)(u.z,{variant:"outline",size:"sm",className:"ml-2",children:[(0,t.jsx)(B.Z,{className:"h-4 w-4 mr-2"}),"Probar IA"]})}),(0,t.jsxs)(P.cZ,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,t.jsxs)(P.fK,{children:[(0,t.jsxs)(P.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)(q.Z,{className:"h-5 w-5 text-primary"}),"Simulador de IA Activa"]}),(0,t.jsxs)(P.Be,{children:["Simule un mensaje entrante de ",s," para probar c\xf3mo responder\xe1n las automatizaciones"]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Mensaje simulado:"}),(0,t.jsx)(b.g,{value:i,onChange:e=>l(e.target.value),placeholder:"Escriba el mensaje que el contacto enviar\xeda...",rows:4,className:"resize-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Mensajes de prueba r\xe1pida:"}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-2",children:["Hola, me interesa conocer m\xe1s sobre sus productos y precios","Tengo un problema con mi pedido, necesito ayuda urgente","Buenos d\xedas, quisiera hacer una queja sobre el servicio","\xbfPodr\xedan ayudarme a agendar una cita para ma\xf1ana?","\xbfC\xf3mo puedo realizar el pago de mi factura pendiente?","Muchas gracias por su atenci\xf3n, que tengan buen d\xeda"].map((e,s)=>(0,t.jsxs)(u.z,{variant:"ghost",size:"sm",onClick:()=>g(e),className:"text-xs h-auto py-2 px-3 whitespace-normal text-left justify-start",children:[(0,t.jsx)(Z.Z,{className:"h-3 w-3 mr-2 flex-shrink-0"}),e]},s))})]}),(0,t.jsx)(u.z,{onClick:j,disabled:c||!i.trim(),className:"w-full",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(B.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Simulando y procesando con IA..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(q.Z,{className:"h-4 w-4 mr-2"}),"Simular Mensaje Entrante"]})}),x&&(0,t.jsxs)(G.bZ,{variant:"destructive",children:[(0,t.jsx)(U.Z,{className:"h-4 w-4"}),(0,t.jsx)(G.X,{children:x})]}),o&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(G.bZ,{children:[(0,t.jsx)(V.Z,{className:"h-4 w-4"}),(0,t.jsx)(G.X,{children:"✅ Mensaje simulado exitosamente. El mensaje aparecer\xe1 en la conversaci\xf3n y se proces\xf3 con IA."})]}),o.aiProcessing&&(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{children:(0,t.jsxs)(w.ll,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(B.Z,{className:"h-4 w-4"}),"Resultado del An\xe1lisis de IA"]})}),(0,t.jsxs)(w.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(L.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Intenciones Detectadas"}),(0,t.jsxs)(h.C,{variant:"outline",children:["Confianza: ",Math.round(100*o.aiProcessing.analysis.confidenceScore),"%"]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:o.aiProcessing.analysis.detectedIntentions.map(e=>(0,t.jsx)(h.C,{variant:"default",children:f.ED[e]||e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)($.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Automatizaciones"})]}),(0,t.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(V.Z,{className:"h-4 w-4 text-green-600"}),(0,t.jsxs)("span",{children:[o.aiProcessing.automationsExecuted," ejecutadas"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(k.Z,{className:"h-4 w-4 text-gray-500"}),(0,t.jsxs)("span",{children:[o.aiProcessing.automationsSkipped," omitidas"]})]})]})]}),o.aiProcessing.analysis.keywordsExtracted.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,t.jsx)("span",{className:"text-sm font-medium",children:"Palabras Clave"})}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:o.aiProcessing.analysis.keywordsExtracted.map((e,s)=>(0,t.jsx)(h.C,{variant:"secondary",children:e},s))})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-xs pt-2 border-t",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:"Sentimiento"}),(0,t.jsx)("div",{className:(e=>{switch(e){case"positive":return"text-green-600";case"negative":return"text-red-600";default:return"text-gray-600"}})(o.aiProcessing.analysis.sentiment),children:"positive"===o.aiProcessing.analysis.sentiment?"Positivo":"negative"===o.aiProcessing.analysis.sentiment?"Negativo":"Neutral"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:"Tiempo de Procesamiento"}),(0,t.jsxs)("div",{className:"text-muted-foreground",children:[o.aiProcessing.analysis.processingTime,"ms"]})]})]})]})]}),(0,t.jsxs)(G.bZ,{children:[(0,t.jsx)(F.Z,{className:"h-4 w-4"}),(0,t.jsxs)(G.X,{children:["\uD83D\uDCA1 ",(0,t.jsx)("strong",{children:"Tip:"})," Revise la conversaci\xf3n para ver el mensaje simulado y cualquier acci\xf3n autom\xe1tica que se haya ejecutado (etiquetas, asignaciones, respuestas autom\xe1ticas, etc.)."]})]})]}),(0,t.jsx)("div",{className:"flex justify-end pt-4",children:(0,t.jsx)(u.z,{variant:"outline",onClick:()=>r(!1),children:"Cerrar"})})]})]})]})}var X=a(66124),H=a(70362),_=a(27693),Q=a(13856),W=a(99983);function J({conversationId:e,className:s}){let[a,r]=(0,n.useState)(!0),[i,l]=(0,n.useState)(0),[c,d]=(0,n.useState)(0);(0,n.useEffect)(()=>{o()},[]);let o=async()=>{try{l(42),d(15)}catch(e){console.error("Error cargando estad\xedsticas de IA:",e)}};return(0,t.jsxs)(P.Vq,{children:[(0,t.jsx)(P.hg,{asChild:!0,children:(0,t.jsx)(h.C,{variant:"outline",className:`${a?"bg-green-100 text-green-800 border-green-200":"bg-gray-100 text-gray-600 border-gray-200"} cursor-pointer hover:shadow-md transition-shadow ${s}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[a?(0,t.jsx)(X.Z,{className:"h-3 w-3"}):(0,t.jsx)(H.Z,{className:"h-3 w-3"}),(0,t.jsx)(_.Z,{className:"h-3 w-3"}),(0,t.jsxs)("span",{className:"font-medium",children:["IA Resolutiva ",a?"Activa":"Inactiva"]})]})})}),(0,t.jsxs)(P.cZ,{className:"max-w-2xl",children:[(0,t.jsxs)(P.fK,{children:[(0,t.jsxs)(P.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)(B.Z,{className:"h-5 w-5 text-blue-500"}),"Estado del Sistema de IA Resolutiva"]}),(0,t.jsx)(P.Be,{children:"Sistema inteligente que responde autom\xe1ticamente usando la Base de Conocimiento"})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(w.Zb,{children:(0,t.jsx)(w.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${a?"bg-green-100":"bg-gray-100"}`,children:a?(0,t.jsx)($.Z,{className:"h-5 w-5 text-green-600"}):(0,t.jsx)(H.Z,{className:"h-5 w-5 text-gray-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold text-lg",children:["Sistema ",a?"Operativo":"Inactivo"]}),(0,t.jsx)("p",{className:"text-gray-600 text-sm",children:a?"La IA est\xe1 respondiendo autom\xe1ticamente a consultas de clientes":"La IA no est\xe1 procesando mensajes autom\xe1ticamente"})]})]}),(0,t.jsxs)(u.z,{variant:a?"destructive":"default",size:"sm",onClick:()=>r(!a),children:[a?"Desactivar":"Activar"," IA"]})]})})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(w.Zb,{children:(0,t.jsxs)(w.aY,{className:"pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 text-blue-500"}),(0,t.jsx)("span",{className:"font-medium text-sm",children:"B\xfasqueda Sem\xe1ntica"})]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:i}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"Fuentes activas"})]})}),(0,t.jsx)(w.Zb,{children:(0,t.jsxs)(w.aY,{className:"pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(L.Z,{className:"h-4 w-4 text-green-500"}),(0,t.jsx)("span",{className:"font-medium text-sm",children:"Resoluciones"})]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:c}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"\xdaltimos 7 d\xedas"})]})}),(0,t.jsx)(w.Zb,{children:(0,t.jsxs)(w.aY,{className:"pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(W.Z,{className:"h-4 w-4 text-purple-500"}),(0,t.jsx)("span",{className:"font-medium text-sm",children:"Precisi\xf3n"})]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:"87%"}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"Confianza promedio"})]})})]}),(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{children:(0,t.jsx)(w.ll,{className:"text-base",children:"\xbfC\xf3mo Funciona?"})}),(0,t.jsx)(w.aY,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,t.jsx)("span",{className:"text-blue-600 text-xs font-bold",children:"1"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"An\xe1lisis Inteligente"}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"La IA analiza cada mensaje entrante para detectar intenciones y necesidades"})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,t.jsx)("span",{className:"text-green-600 text-xs font-bold",children:"2"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"B\xfasqueda en Knowledge Base"}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"Busca informaci\xf3n relevante en documentos, manuales y cat\xe1logos subidos"})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,t.jsx)("span",{className:"text-purple-600 text-xs font-bold",children:"3"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Respuesta + Archivos"}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"Genera respuesta contextual y env\xeda autom\xe1ticamente los archivos relevantes"})]})]})]})})]}),(0,t.jsxs)(w.Zb,{children:[(0,t.jsxs)(w.Ol,{children:[(0,t.jsx)(w.ll,{className:"text-base",children:"Configuraci\xf3n R\xe1pida"}),(0,t.jsx)(w.SZ,{children:"Ajusta el comportamiento de la IA para este chat espec\xedfico"})]}),(0,t.jsxs)(w.aY,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(I.Z,{className:"h-4 w-4 text-gray-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Enviar archivos autom\xe1ticamente"})]}),(0,t.jsx)(h.C,{variant:"secondary",children:"Activo"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(k.Z,{className:"h-4 w-4 text-gray-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Respuesta inmediata (sin delay)"})]}),(0,t.jsx)(h.C,{variant:"secondary",children:"Activo"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(L.Z,{className:"h-4 w-4 text-gray-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Confianza m\xednima para responder"})]}),(0,t.jsx)(h.C,{variant:"outline",children:"70%"})]})]})]})]})]})]})}function K({conversation:e,onSendMessage:s,onUpdateStatus:a,onAssignAgent:r}){let[i,l]=(0,n.useState)(""),c=(0,n.useRef)(null);(0,n.useRef)(null);let d=()=>{c.current?.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{d()},[e?.messages]);let o=e=>new Date(e).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),x=e=>{let s=new Date,a=new Date(e);if(a.toDateString()===s.toDateString())return"Hoy";let t=new Date(s);return(t.setDate(t.getDate()-1),a.toDateString()===t.toDateString())?"Ayer":a.toLocaleDateString("es-ES",{day:"2-digit",month:"short"})},N=e=>e.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2);if(!e)return(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-200 rounded-full flex items-center justify-center",children:(0,t.jsx)(m.Z,{className:"w-8 h-8 text-gray-400"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Selecciona una conversaci\xf3n"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Elige un chat de la lista para comenzar a conversar"})]})});let b=(e=>{let s={};return e.forEach(e=>{let a=new Date(e.sentAt).toDateString();s[a]||(s[a]=[]),s[a].push(e)}),Object.entries(s).map(([e,s])=>({date:new Date(e),messages:s}))})(e.messages);return(0,t.jsxs)("div",{className:"flex-1 flex flex-col bg-white",children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)(p.Avatar,{className:"h-10 w-10",children:[(0,t.jsx)(p.AvatarImage,{src:e.contact.avatar}),(0,t.jsx)(p.AvatarFallback,{className:"bg-gray-100 text-gray-600",children:N(e.contact.name)})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.contact.name,e.contact.isVip&&(0,t.jsx)(h.C,{variant:"secondary",className:"ml-2 bg-yellow-100 text-yellow-800",children:"VIP"}),(0,t.jsx)(J,{conversationId:e.id,className:"ml-2"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[(0,t.jsx)("span",{children:e.contact.phone}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)(h.C,{variant:"outline",className:(0,g.cn)("text-xs","OPEN"===e.status&&"border-green-200 text-green-700","PENDING"===e.status&&"border-yellow-200 text-yellow-700","RESOLVED"===e.status&&"border-gray-200 text-gray-700"),children:f.WY[e.status]}),(0,t.jsx)(h.C,{variant:"outline",className:"text-xs",children:f.Go[e.priority]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(Y,{conversationId:e.id,contactName:e.contact.name}),(0,t.jsx)(u.z,{variant:"ghost",size:"sm",children:(0,t.jsx)(m.Z,{className:"h-4 w-4"})}),(0,t.jsx)(u.z,{variant:"ghost",size:"sm",children:(0,t.jsx)(v.Z,{className:"h-4 w-4"})}),(0,t.jsxs)(j.h_,{children:[(0,t.jsx)(j.$F,{asChild:!0,children:(0,t.jsx)(u.z,{variant:"ghost",size:"sm",children:(0,t.jsx)(y.Z,{className:"h-4 w-4"})})}),(0,t.jsxs)(j.AW,{align:"end",children:[(0,t.jsx)(j.Ju,{children:"Acciones"}),(0,t.jsx)(j.VD,{}),(0,t.jsx)(j.Xi,{onClick:()=>a("PENDING"),children:"Marcar como pendiente"}),(0,t.jsx)(j.Xi,{onClick:()=>a("RESOLVED"),children:"Marcar como resuelta"}),(0,t.jsx)(j.Xi,{onClick:()=>a("ARCHIVED"),children:"Archivar conversaci\xf3n"})]})]})]})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:(0,t.jsxs)("div",{className:"space-y-4",children:[b.map((s,a)=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex justify-center my-4",children:(0,t.jsx)("span",{className:"px-3 py-1 bg-gray-200 text-xs text-gray-600 rounded-full",children:x(s.date)})}),(0,t.jsx)("div",{className:"space-y-2",children:s.messages.map(s=>(0,t.jsxs)("div",{className:(0,g.cn)("flex items-end space-x-2","OUTGOING"===s.direction?"justify-end":"justify-start"),children:["INCOMING"===s.direction&&(0,t.jsxs)(p.Avatar,{className:"h-6 w-6",children:[(0,t.jsx)(p.AvatarImage,{src:e.contact.avatar}),(0,t.jsx)(p.AvatarFallback,{className:"text-xs",children:N(e.contact.name)})]}),(0,t.jsxs)("div",{className:(0,g.cn)("max-w-xs lg:max-w-md xl:max-w-lg px-4 py-2 rounded-lg shadow-sm","OUTGOING"===s.direction?"bg-blue-600 text-white":"bg-white text-gray-900 border"),children:[s.replyTo&&(0,t.jsxs)("div",{className:(0,g.cn)("text-xs border-l-2 pl-2 mb-1 opacity-70","OUTGOING"===s.direction?"border-blue-300":"border-gray-300"),children:[(0,t.jsx)("p",{className:"font-medium",children:s.replyTo.sentByName||"Cliente"}),(0,t.jsx)("p",{children:s.replyTo.content})]}),(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:s.content}),(0,t.jsxs)("div",{className:"flex items-center justify-end mt-1 space-x-1",children:[(0,t.jsx)("span",{className:(0,g.cn)("text-xs","OUTGOING"===s.direction?"text-blue-200":"text-gray-500"),children:o(s.sentAt)}),"OUTGOING"===s.direction&&(0,t.jsxs)("div",{className:"flex space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-200"}),s.isRead&&(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-200"})]})]})]}),"OUTGOING"===s.direction&&s.sentByName&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:s.sentByName})]},s.id))})]},a)),(0,t.jsx)("div",{ref:c})]})}),(0,t.jsx)(O,{conversationId:e.id,onSendMessage:e=>{s(e.content,e.type),console.log("Enviando mensaje con opciones:",e)},placeholder:"Escribe tu mensaje..."})]})}var ee=a(79582),es=a(35798),ea=a(20730),et=a(28576),en=a(37665),er=a(39429);function ei({contact:e,onAddNote:s,onAddTag:a,onRemoveTag:r,onUpdateContact:i}){let[l,c]=(0,n.useState)(""),[d,o]=(0,n.useState)(""),[j,f]=(0,n.useState)(!1),[N,v]=(0,n.useState)(!1),y=()=>{if(d.trim()){let e=["blue","green","yellow","red","purple","pink"],s=e[Math.floor(Math.random()*e.length)];a(d.trim(),s),o(""),v(!1)}},C=e=>new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e?(0,t.jsxs)("div",{className:"w-80 bg-white border-l border-gray-200 flex flex-col h-full overflow-y-auto",children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"relative inline-block mb-3",children:[(0,t.jsxs)(p.Avatar,{className:"h-20 w-20",children:[(0,t.jsx)(p.AvatarImage,{src:e.avatar}),(0,t.jsx)(p.AvatarFallback,{className:"text-xl bg-gray-100 text-gray-600",children:e.name.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2)})]}),e.isVip&&(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center",children:(0,t.jsx)(ee.Z,{className:"w-3 h-3 text-white fill-current"})})]}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center justify-center text-sm text-gray-500 mb-2",children:[(0,t.jsx)(m.Z,{className:"w-4 h-4 mr-1"}),e.phone]}),e.email&&(0,t.jsxs)("div",{className:"flex items-center justify-center text-sm text-gray-500 mb-3",children:[(0,t.jsx)(es.Z,{className:"w-4 h-4 mr-1"}),e.email]}),(0,t.jsx)(h.C,{variant:"ACTIVE"===e.status?"default":"secondary",className:"mb-4",children:"ACTIVE"===e.status?"Activo":e.status})]})}),(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{className:"pb-3",children:(0,t.jsxs)(w.ll,{className:"text-sm flex items-center",children:[(0,t.jsx)(ea.Z,{className:"w-4 h-4 mr-2"}),"Informaci\xf3n"]})}),(0,t.jsxs)(w.aY,{className:"pt-0 space-y-2",children:[e.company&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Empresa"}),(0,t.jsx)("p",{className:"text-sm",children:e.company})]}),e.jobTitle&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Cargo"}),(0,t.jsx)("p",{className:"text-sm",children:e.jobTitle})]}),(e.city||e.country)&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Ubicaci\xf3n"}),(0,t.jsxs)("div",{className:"flex items-center text-sm",children:[(0,t.jsx)(et.Z,{className:"w-3 h-3 mr-1"}),[e.city,e.country].filter(Boolean).join(", ")]})]}),e.source&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Origen"}),(0,t.jsx)("p",{className:"text-sm",children:e.source})]})]})]}),(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(w.ll,{className:"text-sm flex items-center",children:[(0,t.jsx)(en.Z,{className:"w-4 h-4 mr-2"}),"Etiquetas"]}),(0,t.jsx)(u.z,{variant:"ghost",size:"sm",onClick:()=>v(!0),children:(0,t.jsx)(er.Z,{className:"w-3 h-3"})})]})}),(0,t.jsxs)(w.aY,{className:"pt-0",children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:e.tags.map(e=>(0,t.jsxs)(h.C,{variant:"outline",className:(0,g.cn)("text-xs cursor-pointer hover:bg-red-50 hover:border-red-200","blue"===e.color&&"border-blue-200 text-blue-700 bg-blue-50","green"===e.color&&"border-green-200 text-green-700 bg-green-50","yellow"===e.color&&"border-yellow-200 text-yellow-700 bg-yellow-50","red"===e.color&&"border-red-200 text-red-700 bg-red-50","purple"===e.color&&"border-purple-200 text-purple-700 bg-purple-50","pink"===e.color&&"border-pink-200 text-pink-700 bg-pink-50"),onClick:()=>r(e.id),children:[e.name," \xd7"]},e.id))}),N&&(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(x.I,{value:d,onChange:e=>o(e.target.value),placeholder:"Nueva etiqueta",className:"text-xs",onKeyPress:e=>"Enter"===e.key&&y()}),(0,t.jsx)(u.z,{size:"sm",onClick:y,children:(0,t.jsx)(er.Z,{className:"w-3 h-3"})})]})]})]}),(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{className:"pb-3",children:(0,t.jsxs)(w.ll,{className:"text-sm flex items-center",children:[(0,t.jsx)(k.Z,{className:"w-4 h-4 mr-2"}),"Actividad"]})}),(0,t.jsxs)(w.aY,{className:"pt-0 space-y-3",children:[e.firstContact&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Primer contacto"}),(0,t.jsx)("p",{className:"text-sm",children:C(e.firstContact)})]}),e.lastContact&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"\xdaltimo contacto"}),(0,t.jsx)("p",{className:"text-sm",children:C(e.lastContact)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Mensajes no le\xeddos"}),(0,t.jsx)("p",{className:"text-sm font-medium text-blue-600",children:e.unreadCount})]}),void 0!==e.leadScore&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Puntaje de lead"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:(0,t.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.leadScore}%`}})}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:[e.leadScore,"/100"]})]})]})]})]}),(0,t.jsxs)(w.Zb,{children:[(0,t.jsxs)(w.Ol,{className:"pb-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(w.ll,{className:"text-sm",children:"Notas Internas"}),(0,t.jsx)(u.z,{variant:"ghost",size:"sm",onClick:()=>f(!0),children:(0,t.jsx)(er.Z,{className:"w-3 h-3"})})]}),(0,t.jsx)(w.SZ,{className:"text-xs",children:"Solo visibles para tu equipo"})]}),(0,t.jsxs)(w.aY,{className:"pt-0",children:[j&&(0,t.jsxs)("div",{className:"mb-4 p-3 border rounded-lg bg-gray-50",children:[(0,t.jsx)(b.g,{value:l,onChange:e=>c(e.target.value),placeholder:"Escribe una nota interna...",className:"text-sm mb-2",rows:3}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(u.z,{variant:"ghost",size:"sm",onClick:()=>{f(!1),c("")},children:"Cancelar"}),(0,t.jsx)(u.z,{size:"sm",onClick:()=>{l.trim()&&(s(l.trim()),c(""),f(!1))},children:"Guardar"})]})]}),(0,t.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:0===e.notes.length?(0,t.jsx)("p",{className:"text-xs text-gray-500 text-center py-4",children:"No hay notas internas"}):e.notes.map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded-lg bg-gray-50",children:[(0,t.jsx)("p",{className:"text-sm mb-2",children:e.content}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,t.jsx)("span",{children:e.createdByName}),(0,t.jsx)("span",{children:C(e.createdAt)})]}),e.isImportant&&(0,t.jsx)(h.C,{variant:"outline",className:"mt-1 text-xs",children:"Importante"})]},e.id))})]})]})]})]}):(0,t.jsx)("div",{className:"w-80 bg-white border-l border-gray-200 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center p-6",children:[(0,t.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-200 rounded-full flex items-center justify-center",children:(0,t.jsx)(m.Z,{className:"w-6 h-6 text-gray-400"})}),(0,t.jsx)("p",{className:"text-gray-500",children:"Selecciona una conversaci\xf3n para ver los detalles del contacto"})]})})}let el=[{id:"1",contact:{id:"1",name:"Juan P\xe9rez Garc\xeda",phone:"+52 55 1234 5678",avatar:"",isVip:!0},status:"OPEN",priority:"HIGH",assignedAgent:{id:"agent1",name:"Ana Mart\xednez"},messageCount:15,unreadCount:3,lastMessageAt:new Date(Date.now()-3e5),lastMessageText:"\xbfTienen disponibilidad para esta semana?",lastMessageFrom:"INCOMING"},{id:"2",contact:{id:"2",name:"Mar\xeda Garc\xeda L\xf3pez",phone:"+52 55 8765 4321",avatar:"",isVip:!1},status:"PENDING",priority:"MEDIUM",messageCount:8,unreadCount:1,lastMessageAt:new Date(Date.now()-9e5),lastMessageText:"Gracias por la informaci\xf3n, excelente servicio",lastMessageFrom:"INCOMING"},{id:"3",contact:{id:"3",name:"Carlos Rodr\xedguez",phone:"+52 55 5555 0000",avatar:"",isVip:!1},status:"OPEN",priority:"URGENT",messageCount:22,unreadCount:5,lastMessageAt:new Date(Date.now()-36e5),lastMessageText:"Necesito m\xe1s informaci\xf3n sobre los precios urgentemente",lastMessageFrom:"INCOMING"},{id:"4",contact:{id:"4",name:"Ana Fern\xe1ndez",phone:"+52 55 9999 1111",avatar:"",isVip:!0},status:"RESOLVED",priority:"LOW",assignedAgent:{id:"agent2",name:"Roberto Silva"},messageCount:6,unreadCount:0,lastMessageAt:new Date(Date.now()-72e5),lastMessageText:"Perfecto, muchas gracias por todo",lastMessageFrom:"OUTGOING"}],ec={1:[{id:"m1",conversationId:"1",direction:"INCOMING",type:"TEXT",content:"Hola, buenos d\xedas. Me interesa conocer sus servicios.",sentAt:new Date(Date.now()-72e5),isRead:!0},{id:"m2",conversationId:"1",direction:"OUTGOING",type:"TEXT",content:"\xa1Hola Juan! Muchas gracias por contactarnos. Con mucho gusto te ayudo con informaci\xf3n sobre nuestros servicios. \xbfEn qu\xe9 \xe1rea espec\xedficamente est\xe1s interesado?",sentBy:"agent1",sentByName:"Ana Mart\xednez",sentAt:new Date(Date.now()-66e5),isRead:!0},{id:"m3",conversationId:"1",direction:"INCOMING",type:"TEXT",content:"Me interesa el servicio de consultor\xeda empresarial. Tengo una empresa mediana y necesito optimizar procesos.",sentAt:new Date(Date.now()-6e6),isRead:!0},{id:"m4",conversationId:"1",direction:"OUTGOING",type:"TEXT",content:"Perfecto! Nuestro servicio de consultor\xeda es ideal para empresas como la tuya. Te puedo agendar una llamada para esta semana y hacer una evaluaci\xf3n inicial sin costo.",sentBy:"agent1",sentByName:"Ana Mart\xednez",sentAt:new Date(Date.now()-54e5),isRead:!0},{id:"m5",conversationId:"1",direction:"INCOMING",type:"TEXT",content:"\xbfTienen disponibilidad para esta semana?",sentAt:new Date(Date.now()-3e5),isRead:!1}]},ed={1:{id:"1",name:"Juan P\xe9rez Garc\xeda",phone:"+52 55 1234 5678",email:"juan.perez@empresa.com",avatar:"",status:"ACTIVE",isVip:!0,lastContact:new Date(Date.now()-3e5),unreadCount:3,firstName:"Juan",lastName:"P\xe9rez Garc\xeda",company:"Empresa ABC S.A. de C.V.",jobTitle:"Director General",city:"Ciudad de M\xe9xico",country:"M\xe9xico",source:"Referido",leadScore:85,lifetimeValue:15e3,firstContact:new Date(Date.now()-2592e6),tags:[{id:"t1",name:"Cliente VIP",color:"yellow"},{id:"t2",name:"Prospecto Caliente",color:"red"},{id:"t3",name:"Consultor\xeda",color:"blue"}],notes:[{id:"n1",content:"Cliente muy interesado en servicios de consultor\xeda. Empresa mediana con buen potencial de crecimiento.",isImportant:!0,createdBy:"agent1",createdByName:"Ana Mart\xednez",createdAt:new Date(Date.now()-864e5)},{id:"n2",content:"Prefiere llamadas en horario matutino entre 9-11 AM.",isImportant:!1,createdBy:"agent1",createdByName:"Ana Mart\xednez",createdAt:new Date(Date.now()-432e5)}],lastConversation:{id:"1",lastMessageText:"\xbfTienen disponibilidad para esta semana?",lastMessageAt:new Date(Date.now()-3e5),status:"OPEN"}}};function eo(){let{data:e}=(0,r.useSession)()||{},[s]=(0,n.useState)(el),[a,c]=(0,n.useState)(),[d,o]=(0,n.useState)(null),[m,x]=(0,n.useState)(null),[u,h]=(0,n.useState)(""),[p,j]=(0,n.useState)("ALL");return(0,n.useEffect)(()=>{if(a){let e=s.find(e=>e.id===a),t=ec[a]||[],n=ed[e?.contact.id||""];e&&n&&(o({id:e.id,contact:n,status:e.status,priority:e.priority,assignedAgent:e.assignedAgent,messageCount:e.messageCount,unreadCount:e.unreadCount,messages:t,createdAt:new Date(Date.now()-2592e6),updatedAt:new Date(e.lastMessageAt||Date.now())}),x(n))}else o(null),x(null)},[a,s]),(0,n.useEffect)(()=>{s.length>0&&!a&&c(s[0].id)},[s,a]),(0,t.jsx)(i.ProtectedRoute,{permissions:[l.y3.VIEW_CRM_INBOX],children:(0,t.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,t.jsx)(N,{conversations:s,selectedConversationId:a,onSelectConversation:c,searchTerm:u,onSearchChange:h,statusFilter:p,onStatusFilterChange:j}),(0,t.jsx)(K,{conversation:d,onSendMessage:(s,a="TEXT")=>{if(!d)return;let t={id:`m${Date.now()}`,conversationId:d.id,direction:"OUTGOING",type:a,content:s,sentBy:e?.user?.id||"current-user",sentByName:e?.user?.name||"Usuario",sentAt:new Date,isRead:!0};o(e=>e?{...e,messages:[...e.messages,t]}:null),console.log("Enviando mensaje:",t)},onUpdateStatus:e=>{d&&(o(s=>s?{...s,status:e}:null),console.log("Actualizando estado:",e))},onAssignAgent:e=>{console.log("Asignando agente:",e)}}),(0,t.jsx)(ei,{contact:m,onAddNote:(s,a=!1)=>{if(!m)return;let t={id:`n${Date.now()}`,content:s,isImportant:a,createdBy:e?.user?.id||"current-user",createdByName:e?.user?.name||"Usuario",createdAt:new Date};x(e=>e?{...e,notes:[t,...e.notes]}:null),console.log("Agregando nota:",t)},onAddTag:(e,s)=>{if(!m)return;let a={id:`t${Date.now()}`,name:e,color:s||"blue"};x(e=>e?{...e,tags:[...e.tags,a]}:null),console.log("Agregando etiqueta:",a)},onRemoveTag:e=>{m&&(x(s=>s?{...s,tags:s.tags.filter(s=>s.id!==e)}:null),console.log("Eliminando etiqueta:",e))},onUpdateContact:e=>{m&&(x(s=>s?{...s,...e}:null),console.log("Actualizando contacto:",e))}})]})})}},81577:function(e,s,a){"use strict";a.d(s,{Avatar:function(){return l},AvatarFallback:function(){return d},AvatarImage:function(){return c}});var t=a(15444),n=a(89300),r=a(40445),i=a(65522);let l=n.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.fC,{ref:a,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));l.displayName=r.fC.displayName;let c=n.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.Ee,{ref:a,className:(0,i.cn)("aspect-square h-full w-full",e),...s}));c.displayName=r.Ee.displayName;let d=n.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.NY,{ref:a,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));d.displayName=r.NY.displayName},29530:function(e,s,a){"use strict";a.d(s,{$N:function(){return p},Be:function(){return j},Vq:function(){return c},cN:function(){return h},cZ:function(){return x},fK:function(){return u},hg:function(){return d}});var t=a(15444),n=a(89300),r=a(49095),i=a(33485),l=a(65522);let c=r.fC,d=r.xz,o=r.h_;r.x8;let m=n.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.aV,{ref:a,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));m.displayName=r.aV.displayName;let x=n.forwardRef(({className:e,children:s,...a},n)=>(0,t.jsxs)(o,{children:[(0,t.jsx)(m,{}),(0,t.jsxs)(r.VY,{ref:n,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[s,(0,t.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(i.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));x.displayName=r.VY.displayName;let u=({className:e,...s})=>(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});u.displayName="DialogHeader";let h=({className:e,...s})=>(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});h.displayName="DialogFooter";let p=n.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.Dx,{ref:a,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));p.displayName=r.Dx.displayName;let j=n.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.dk,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",e),...s}));j.displayName=r.dk.displayName},74678:function(e,s,a){"use strict";a.d(s,{I:function(){return i}});var t=a(15444),n=a(89300),r=a(65522);let i=n.forwardRef(({className:e,type:s,...a},n)=>(0,t.jsx)("input",{type:s,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...a}));i.displayName="Input"},37108:function(e,s,a){"use strict";a.d(s,{E:function(){return l}});var t=a(15444),n=a(89300),r=a(25052),i=a(65522);let l=n.forwardRef(({className:e,value:s,...a},n)=>(0,t.jsx)(r.fC,{ref:n,className:(0,i.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...a,children:(0,t.jsx)(r.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));l.displayName=r.fC.displayName},67012:function(e,s,a){"use strict";a.d(s,{g:function(){return i}});var t=a(15444),n=a(89300),r=a(65522);let i=n.forwardRef(({className:e,...s},a)=>(0,t.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...s}));i.displayName="Textarea"}},function(e){e.O(0,[9993,5762,688,8077,8151,6298,2578,7238,5268,2538,7232,2386,7156,1744],function(){return e(e.s=5988)}),_N_E=e.O()}]);