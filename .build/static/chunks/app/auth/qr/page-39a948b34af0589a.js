(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9650],{77747:function(e,t,a){Promise.resolve().then(a.bind(a,1573))},1573:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var s=a(15444),r=a(89300),n=a(2422),i=a(74678),l=a(34635),o=a(56948),c=a(99827),d=a(86765),u=a(66124),m=a(66772),f=a(46570),x=a(43691),g=a(4805),p=a(52429),h=a(25422),b=a(1946),v=a(79047),j=a(95854);function N(){let[e,t]=(0,r.useState)(null),[a,N]=(0,r.useState)(""),[y,w]=(0,r.useState)(""),[C,S]=(0,r.useState)(!1),[T,R]=(0,r.useState)(!1),[E,A]=(0,r.useState)(""),[O,k]=(0,r.useState)(!1),[Z,I]=(0,r.useState)(""),_=(0,r.useRef)(null);(0,v.useRouter)();let{toast:D}=(0,j.pm)(),Q=e=>{try{let a=JSON.parse(e);if(!a.sessionId||!a.token||!a.timestamp||!a.domain)throw Error("C\xf3digo QR inv\xe1lido");if(Date.now()-a.timestamp>6e5)throw Error("El c\xf3digo QR ha expirado");t(a),A(""),D({title:"C\xf3digo QR detectado",description:"Ahora ingresa tus credenciales para autenticarte"})}catch(e){console.error("Error procesando QR:",e),A(e instanceof Error?e.message:"C\xf3digo QR inv\xe1lido")}},z=async t=>{if(t.preventDefault(),!e){A("Primero escanea o ingresa el c\xf3digo QR");return}if(!a||!y){A("Completa todos los campos");return}R(!0),A("");try{let t=await fetch("/api/auth/qr/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e.token,sessionId:e.sessionId,userEmail:a,userPassword:y})}),s=await t.json();s.success?(k(!0),D({title:"\xa1Autenticaci\xf3n exitosa!",description:"Puedes cerrar esta ventana y volver al escritorio"}),setTimeout(()=>{window.close()},3e3)):(A(s.error||"Error en la autenticaci\xf3n"),D({title:"Error de autenticaci\xf3n",description:s.error||"Error en la autenticaci\xf3n",variant:"destructive"}))}catch(e){console.error("Auth error:",e),A("Error de conexi\xf3n")}finally{R(!1)}};return O?(0,s.jsxs)("div",{className:"text-center p-8",children:[(0,s.jsx)(u.Z,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"\xa1Autenticaci\xf3n Exitosa!"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Ya puedes volver al escritorio y continuar usando la aplicaci\xf3n."}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Esta ventana se cerrar\xe1 autom\xe1ticamente en unos segundos."})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[E&&(0,s.jsxs)(o.bZ,{variant:"destructive",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4"}),(0,s.jsx)(o.X,{children:E})]}),e?(0,s.jsxs)(c.Zb,{children:[(0,s.jsxs)(c.Ol,{children:[(0,s.jsxs)(c.ll,{className:"text-lg flex items-center",children:[(0,s.jsx)(u.Z,{className:"mr-2 h-5 w-5 text-green-600"}),"C\xf3digo QR Detectado"]}),(0,s.jsx)(c.SZ,{children:"Ahora ingresa tus credenciales para completar la autenticaci\xf3n"})]}),(0,s.jsxs)(c.aY,{children:[(0,s.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.Label,{htmlFor:"mobile-email",children:"Email"}),(0,s.jsx)(i.I,{id:"mobile-email",type:"email",value:a,onChange:e=>N(e.target.value),placeholder:"tu.email@empresa.com",disabled:T,required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.Label,{htmlFor:"mobile-password",children:"Contrase\xf1a"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(i.I,{id:"mobile-password",type:C?"text":"password",value:y,onChange:e=>w(e.target.value),placeholder:"Tu contrase\xf1a",disabled:T,required:!0}),(0,s.jsx)(n.z,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2",onClick:()=>S(!C),children:C?(0,s.jsx)(p.Z,{className:"h-4 w-4"}):(0,s.jsx)(h.Z,{className:"h-4 w-4"})})]})]}),(0,s.jsx)(n.z,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:T,children:T?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Autenticando..."]}):"Autenticar"})]}),(0,s.jsx)(n.z,{variant:"ghost",onClick:()=>{t(null),I("")},className:"w-full mt-4 text-sm",children:"Cambiar c\xf3digo QR"})]})]}):(0,s.jsxs)(d.Tabs,{defaultValue:"manual",className:"w-full",children:[(0,s.jsxs)(d.TabsList,{className:"grid w-full grid-cols-2",children:[(0,s.jsx)(d.TabsTrigger,{value:"manual",children:"C\xf3digo Manual"}),(0,s.jsx)(d.TabsTrigger,{value:"camera",children:"C\xe1mara/Imagen"})]}),(0,s.jsx)(d.TabsContent,{value:"manual",className:"space-y-4",children:(0,s.jsxs)(c.Zb,{children:[(0,s.jsxs)(c.Ol,{children:[(0,s.jsx)(c.ll,{className:"text-lg",children:"C\xf3digo Manual"}),(0,s.jsx)(c.SZ,{children:"Copia el c\xf3digo del escritorio y p\xe9galo aqu\xed"})]}),(0,s.jsxs)(c.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.Label,{htmlFor:"manual-code",children:"C\xf3digo QR"}),(0,s.jsx)("textarea",{id:"manual-code",value:Z,onChange:e=>I(e.target.value),placeholder:"Pega aqu\xed el c\xf3digo JSON del QR...",rows:4,className:"w-full p-3 border border-gray-300 rounded-md font-mono text-sm resize-none"})]}),(0,s.jsxs)(n.z,{onClick:()=>{if(!Z.trim()){A("Ingresa el c\xf3digo QR");return}Q(Z.trim())},disabled:!Z.trim(),className:"w-full",children:[(0,s.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Procesar C\xf3digo"]})]})]})}),(0,s.jsx)(d.TabsContent,{value:"camera",className:"space-y-4",children:(0,s.jsxs)(c.Zb,{children:[(0,s.jsxs)(c.Ol,{children:[(0,s.jsx)(c.ll,{className:"text-lg",children:"Escanear con C\xe1mara"}),(0,s.jsx)(c.SZ,{children:"Usa la c\xe1mara o carga una imagen del c\xf3digo QR"})]}),(0,s.jsx)(c.aY,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"text-center p-8 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,s.jsx)(x.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Funci\xf3n de c\xe1mara en desarrollo"}),(0,s.jsxs)(n.z,{variant:"outline",onClick:()=>_.current?.click(),children:[(0,s.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Subir Imagen del QR"]}),(0,s.jsx)("input",{ref:_,type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(!t)return;let a=new FileReader;a.onload=e=>{D({title:"Imagen cargada",description:"Por favor, usa el c\xf3digo manual o la c\xe1mara por ahora",variant:"destructive"})},a.readAsDataURL(t)},className:"hidden"})]})})]})})]})]})}var y=a(95181),w=a(98155),C=a(41084);function S(){return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-md",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsxs)("div",{className:"inline-flex items-center space-x-2 text-blue-600 hover:text-blue-700 mb-4",children:[(0,s.jsx)(y.Z,{className:"h-8 w-8"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:"COMOD\xcdN IA"})]}),(0,s.jsx)("p",{className:"text-gray-600",children:"Autenticaci\xf3n con c\xf3digo QR"})]}),(0,s.jsxs)(c.Zb,{className:"shadow-lg border-0",children:[(0,s.jsxs)(c.Ol,{className:"text-center",children:[(0,s.jsxs)(c.ll,{className:"text-2xl font-bold text-gray-900 flex items-center justify-center space-x-2",children:[(0,s.jsx)(y.Z,{className:"h-6 w-6"}),(0,s.jsx)("span",{children:"Escanear C\xf3digo"})]}),(0,s.jsx)(c.SZ,{className:"text-gray-600",children:"Usa tu tel\xe9fono m\xf3vil para escanear el c\xf3digo QR del escritorio"})]}),(0,s.jsxs)(c.aY,{className:"space-y-4",children:[(0,s.jsx)(r.Suspense,{fallback:(0,s.jsxs)("div",{className:"text-center p-8",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{children:"Cargando esc\xe1ner..."})]}),children:(0,s.jsx)(N,{})}),(0,s.jsx)("div",{className:"pt-4 border-t",children:(0,s.jsx)(C.default,{href:"/auth/login",children:(0,s.jsxs)(n.z,{variant:"ghost",className:"w-full text-sm",children:[(0,s.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Volver al login"]})})})]})]})]})})}},56948:function(e,t,a){"use strict";a.d(t,{Cd:function(){return c},X:function(){return d},bZ:function(){return o}});var s=a(15444),r=a(89300),n=a(2371),i=a(65522);let l=(0,n.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=r.forwardRef(({className:e,variant:t,...a},r)=>(0,s.jsx)("div",{ref:r,role:"alert",className:(0,i.cn)(l({variant:t}),e),...a}));o.displayName="Alert";let c=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("h5",{ref:a,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",e),...t}));c.displayName="AlertTitle";let d=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",e),...t}));d.displayName="AlertDescription"},2422:function(e,t,a){"use strict";a.d(t,{d:function(){return o},z:function(){return c}});var s=a(15444),r=a(89300),n=a(21030),i=a(2371),l=a(65522);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef(({className:e,variant:t,size:a,asChild:r=!1,...i},c)=>{let d=r?n.g7:"button";return(0,s.jsx)(d,{className:(0,l.cn)(o({variant:t,size:a,className:e})),ref:c,...i})});c.displayName="Button"},99827:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return o}});var s=a(15444),r=a(89300),n=a(65522);let i=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));i.displayName="Card";let l=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let o=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("h3",{ref:a,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));o.displayName="CardTitle";let c=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("p",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",e),...t}));c.displayName="CardDescription";let d=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent";let u=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t}));u.displayName="CardFooter"},74678:function(e,t,a){"use strict";a.d(t,{I:function(){return i}});var s=a(15444),r=a(89300),n=a(65522);let i=r.forwardRef(({className:e,type:t,...a},r)=>(0,s.jsx)("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));i.displayName="Input"},34635:function(e,t,a){"use strict";a.d(t,{Label:function(){return c}});var s=a(15444),r=a(89300),n=a(4100),i=a(2371),l=a(65522);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)(n.f,{ref:a,className:(0,l.cn)(o(),e),...t}));c.displayName=n.f.displayName},86765:function(e,t,a){"use strict";a.d(t,{Tabs:function(){return l},TabsContent:function(){return d},TabsList:function(){return o},TabsTrigger:function(){return c}});var s=a(15444),r=a(89300),n=a(84018),i=a(65522);let l=n.fC,o=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)(n.aV,{ref:a,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));o.displayName=n.aV.displayName;let c=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)(n.xz,{ref:a,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));c.displayName=n.xz.displayName;let d=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)(n.VY,{ref:a,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));d.displayName=n.VY.displayName},95854:function(e,t,a){"use strict";a.d(t,{pm:function(){return m}});var s=a(89300);let r=0,n=new Map,i=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],c={toasts:[]};function d(e){c=l(c,e),o.forEach(e=>{e(c)})}function u({...e}){let t=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:t});return d({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,t]=s.useState(c);return s.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},65522:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var s=a(32191),r=a(23607);function n(...e){return(0,r.m6)((0,s.W)(e))}}},function(e){e.O(0,[6539,4018,5558,8223,2386,7156,1744],function(){return e(e.s=77747)}),_N_E=e.O()}]);